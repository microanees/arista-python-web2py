

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 8: Web2Py - Prepare the Tool &mdash; Python for Network Engineers</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python for Network Engineers" href="index.html"/>
        <link rel="prev" title="Chapter 7: Creating a New Web2Py Application" href="create-application.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> arista-python-web2py
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Chapter 1: Introducing Python Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="core-concepts.html">Chapter 2: Script Framework for Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Chapter 3: Troubleshooting Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="capacity-planning.html">Chapter 4: Capacity Planning Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="web2py-introduction.html">Chapter 5: Web2Py Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="web2py-installation.html">Chapter 6: Web2Py Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-application.html">Chapter 7: Creating a New Web2Py Application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 8: Web2Py - Prepare the Tool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add-switches">Add Switches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#develop-script">Develop Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-create-a-new-function-and-a-view-for-this-task-add-switches">Step 1: Create a New Function and a View for this task &#8220;Add Switches&#8221;</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-display-a-form-to-receive-input-for-username-password-and-ip-addresses">Step 2: Display a form to receive input for username, password and IP addresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-collect-inventory-and-store-it-in-a-dictionary">Step 3:  Collect inventory and store it in a dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-store-the-dictionary-into-a-json-file">Step 4: Store the dictionary into a JSON file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#view-switches">View Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#categorize-switches">Categorize Switches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Algorithm</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-create-a-new-function-and-view-for-this-task-categorize-switches">Step 1: Create a New Function and View for this task &#8220;Categorize Switches&#8221;</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-read-the-content-of-inventory-json-and-store-it-in-a-dictionary">Step 2: Read the content of inventory.json and store it in a dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-build-a-web2py-form-from-the-dictionary">Step 3: Build a web2py form from the dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-update-site-and-role-field-in-the-dictionary">Step 4: Update site and role field in the dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-write-the-dictionary-in-the-inventory-json-file">Step 5: Write the dictionary in the inventory.json file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">arista-python-web2py</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Chapter 8: Web2Py - Prepare the Tool</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/web2py-prepare.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-8-web2py-prepare-the-tool">
<h1>Chapter 8: Web2Py - Prepare the Tool<a class="headerlink" href="#chapter-8-web2py-prepare-the-tool" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#add-switches" id="id2">Add Switches</a><ul>
<li><a class="reference internal" href="#algorithm" id="id3">Algorithm</a></li>
<li><a class="reference internal" href="#develop-script" id="id4">Develop Script</a><ul>
<li><a class="reference internal" href="#step-1-create-a-new-function-and-a-view-for-this-task-add-switches" id="id5">Step 1: Create a New Function and a View for this task &#8220;Add Switches&#8221;</a></li>
<li><a class="reference internal" href="#step-2-display-a-form-to-receive-input-for-username-password-and-ip-addresses" id="id6">Step 2: Display a form to receive input for username, password and IP addresses</a></li>
<li><a class="reference internal" href="#step-3-collect-inventory-and-store-it-in-a-dictionary" id="id7">Step 3:  Collect inventory and store it in a dictionary</a></li>
<li><a class="reference internal" href="#step-4-store-the-dictionary-into-a-json-file" id="id8">Step 4: Store the dictionary into a JSON file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#view-switches" id="id9">View Switches</a></li>
<li><a class="reference internal" href="#categorize-switches" id="id10">Categorize Switches</a><ul>
<li><a class="reference internal" href="#id1" id="id11">Algorithm</a><ul>
<li><a class="reference internal" href="#step-1-create-a-new-function-and-view-for-this-task-categorize-switches" id="id12">Step 1: Create a New Function and View for this task &#8220;Categorize Switches&#8221;</a></li>
<li><a class="reference internal" href="#step-2-read-the-content-of-inventory-json-and-store-it-in-a-dictionary" id="id13">Step 2: Read the content of inventory.json and store it in a dictionary</a></li>
<li><a class="reference internal" href="#step-3-build-a-web2py-form-from-the-dictionary" id="id14">Step 3: Build a web2py form from the dictionary</a></li>
<li><a class="reference internal" href="#step-4-update-site-and-role-field-in-the-dictionary" id="id15">Step 4: Update site and role field in the dictionary</a></li>
<li><a class="reference internal" href="#step-5-write-the-dictionary-in-the-inventory-json-file" id="id16">Step 5: Write the dictionary in the inventory.json file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#summary" id="id17">Summary</a></li>
</ul>
</div>
<p>In this chapter, we will create functions and views for the tasks in  the &#8220;Prepare the Tool&#8221; category. The purpose of these tasks in &#8220;Prepare the Tool&#8221; category is to provide an option to add the switches in the network manually and maintain the inventory. We will also provide an option to let the users to categorize the switches based on the location and role. Once the users added the switches in the tool, then they can run any operational tasks against those switches. The user will be able to run the tasks on all the switches or on the switches that belong to a specific site and/or on the switches with a specific role.</p>
<img alt="_images/ch08-pic1.png" src="_images/ch08-pic1.png" />
<p>We are going to create three tasks (Add Switches, Categorize Switches and View Switches) in this section. Each task will have one or more functions in the default controller and a corresponding view (.html file).</p>
<div class="section" id="add-switches">
<h2><a class="toc-backref" href="#id2">Add Switches</a><a class="headerlink" href="#add-switches" title="Permalink to this headline">¶</a></h2>
<p>&#8220;Add Switches&#8221; task allows the users to manually add the IP address of the switches into the tool. The tool is going to present a form to the end users where they can enter username, password and the IP address of the switches. Then the task is going to collect some of the basic information about the switches using pyeapi. Finally the task will store the inventory of these switches locally in the server. The task will not save the username and the password anywhere in the server.</p>
<p>We are going to write a function add_inventory in the default controller of our application. Since this will be our first program using web2py, we are going to spend more time in understanding how web2py works. First we will write an algorithm for this task.</p>
<div class="section" id="algorithm">
<h3><a class="toc-backref" href="#id3">Algorithm</a><a class="headerlink" href="#algorithm" title="Permalink to this headline">¶</a></h3>
<p>We are going to collect the information and report it in the following format.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">Inventory</span> <span class="o">=</span> <span class="o">{</span>“&lt;switch_IP_Address&gt;”: <span class="o">{</span>“Hostname”:  “&lt;switch_host_name&gt;”,
                                      “Model”:  “&lt;switch_model&gt;”,
                                      “Version”: “&lt;switch_EOS_Version&gt;”,
                                      “Serial Number”: “&lt;Serial_Number&gt;”,
                                      “Site”: “none”,
                                      “Role”: “none”
                                    <span class="o">}</span>
            <span class="o">}</span>
</pre></div>
</div>
<p>The following Arista EOS commands are used to collect the above information.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>23sw35#show hostname <span class="p">|</span> json
<span class="o">{</span>
    <span class="s2">&quot;fqdn&quot;</span>: <span class="s2">&quot;23sw35&quot;</span>,
<span class="hll">    <span class="s2">&quot;hostname&quot;</span>: <span class="s2">&quot;23sw35&quot;</span>
</span><span class="o">}</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>23sw35#show version <span class="p">|</span> json
<span class="o">{</span>
<span class="hll">    <span class="s2">&quot;modelName&quot;</span>: <span class="s2">&quot;DCS-7250QX-64-F&quot;</span>,
</span>    <span class="s2">&quot;internalVersion&quot;</span>: <span class="s2">&quot;4.15.5M-3054042.4155M&quot;</span>,
    <span class="s2">&quot;systemMacAddress&quot;</span>: <span class="s2">&quot;00:1c:73:5d:13:e9&quot;</span>,
<span class="hll">    <span class="s2">&quot;serialNumber&quot;</span>: <span class="s2">&quot;JPE14300059&quot;</span>,
</span>    <span class="s2">&quot;memTotal&quot;</span>: 8069500,
    <span class="s2">&quot;bootupTimestamp&quot;</span>: 1467299199.33,
    <span class="s2">&quot;memFree&quot;</span>: 4438208,
<span class="hll">    <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;4.15.5M&quot;</span>,
</span>    <span class="s2">&quot;architecture&quot;</span>: <span class="s2">&quot;i386&quot;</span>,
    <span class="s2">&quot;internalBuildId&quot;</span>: <span class="s2">&quot;43b3ce87-6eeb-48ce-bd2a-48e98def005a&quot;</span>,
    <span class="s2">&quot;hardwareRevision&quot;</span>: <span class="s2">&quot;01.03&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Once we collect the data in a dictionary, it is easy to display the content of the dictionary from the view and store it in a file in .json format locally in the server.</p>
<ol class="arabic simple">
<li>Create a New Function and a View for this task &#8220;Add Switches&#8221;</li>
<li>Display a form to input username, password and IP address of the switches.</li>
<li>Collect the inventory from the switches using pyeapi and store it in a dictionary.</li>
<li>Store the dictionary in a json file called inventory.json. Save this file in the /home/www-data/web2py/applications/Arista_EOS_Tool/databases folder.</li>
</ol>
</div>
<div class="section" id="develop-script">
<h3><a class="toc-backref" href="#id4">Develop Script</a><a class="headerlink" href="#develop-script" title="Permalink to this headline">¶</a></h3>
<div class="section" id="step-1-create-a-new-function-and-a-view-for-this-task-add-switches">
<h4><a class="toc-backref" href="#id5">Step 1: Create a New Function and a View for this task &#8220;Add Switches&#8221;</a><a class="headerlink" href="#step-1-create-a-new-function-and-a-view-for-this-task-add-switches" title="Permalink to this headline">¶</a></h4>
<p>Go to admin interface using the url <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/admin/default/index</p>
<p>Arista_EOS_Tool: Manage &#8211;&gt; Edit</p>
<img alt="_images/ch08-pic2.png" src="_images/ch08-pic2.png" />
<p>Controllers: default.py &#8211;&gt; Edit</p>
<img alt="_images/ch08-pic3.png" src="_images/ch08-pic3.png" />
<p>Create a new function add_inventory()</p>
<img alt="_images/ch08-pic4.png" src="_images/ch08-pic4.png" />
<p>Create a View for the function add_inventory</p>
<p>Click the &#8220;files toggle&#8221; on the top left</p>
<p>Click Create and select views from the drop down window</p>
<p>provide the file name with path &#8211;&gt; default/add_inventory.html</p>
<img alt="_images/ch08-pic5.png" src="_images/ch08-pic5.png" />
<p>We are going to keep the default content inside the view. Save this file.</p>
<img alt="_images/ch08-pic6.png" src="_images/ch08-pic6.png" />
<p>You can verify the new function using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/add_inventory. Since the function add_inventory is blank and it returns empty dictionary to the view. The view shows the default layout which shows the default web2py menu bar in the top of the screen and the title &#8220;This is the default/add_inventory.html template&#8221;.</p>
</div>
<div class="section" id="step-2-display-a-form-to-receive-input-for-username-password-and-ip-addresses">
<h4><a class="toc-backref" href="#id6">Step 2: Display a form to receive input for username, password and IP addresses</a><a class="headerlink" href="#step-2-display-a-form-to-receive-input-for-username-password-and-ip-addresses" title="Permalink to this headline">¶</a></h4>
<p>There are few different ways to build forms in web2py. We are going to create a form using web2py&#8217;s SQLFORM.factory. We will define a form using SQLFORM.factory and assign it to a variable called form. Then we will return this variable to view using &#8220;return dict(form=form)&#8221;.</p>
<p>As you can see, there are three fields defined for our form. The first string inside each Field() entry is the name of the variable in which the values the user enters will be stored. This should be unique within the form. Rest of the strings within the Field() are optional.</p>
<p>Edit the add_inventory function in the default controller.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_inventory</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;switchip&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Switch IPs&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>We don&#8217;t have to update the view since we are going to display all variables from the function using the statement &#8220;{{=BEAUTIFY(response._vars)}}&#8221;. We are going to discuss more about views in chapter 11.</p>
<p>Verify the updated function using the same URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/add_inventory.</p>
<img alt="_images/ch08-pic7.png" src="_images/ch08-pic7.png" />
<p>As you can see the field for switches is larger than for username and password. This is because we declared this field as &#8216;text&#8217; when we define the form. Similarly, when you enter the field for password, it won&#8217;t display the content of the password. This is because we declare this field as &#8220;password&#8221; when we define the form.</p>
<p>You can change the display of the field different than the variable name by using label. You can define the fields as mandatory using requires=IS_NOT_EMPTY().</p>
<p>You can refer the &#8220;Forms and validators&#8221; chapter in the <a class="reference external" href="http://web2py.com/book">web2py documentation</a>  to learn more about web2py forms.</p>
</div>
<div class="section" id="step-3-collect-inventory-and-store-it-in-a-dictionary">
<h4><a class="toc-backref" href="#id7">Step 3:  Collect inventory and store it in a dictionary</a><a class="headerlink" href="#step-3-collect-inventory-and-store-it-in-a-dictionary" title="Permalink to this headline">¶</a></h4>
<p>Once the user enters the username, password, IP addresses and submit the form, the script should initiate the pyeapi call and collect the inventory from the switches. The inventory will be stored in a dictionary and displayed to the end user by returning the dictionary to the view.</p>
<p>First we will understand how to accept the values of the form variables from the default controller. So let us update our add_inventory() function to display the value of the IP addresses after the user clicks the submit button.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_inventory</span><span class="p">():</span>
  <span class="c1"># Display form to input Username, Password and Switch IP addresses</span>
  <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
      <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
      <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
      <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;switchip&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Switch IPs&quot;</span><span class="p">))</span>

  <span class="c1"># if the form is accepted, collect the information from the switches</span>
<span class="hll">  <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
</span><span class="hll">      <span class="c1"># Initiate inventory with blank dictionary</span>
</span><span class="hll">      <span class="n">inventory</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1"># Since switch IPs are input as text with multiple IPs one per line,</span>
</span><span class="hll">      <span class="c1"># We will convert the text into List with the list of switch IP addresses</span>
</span><span class="hll">      <span class="n">switchip_list</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">switchip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1"># For each IP in the list switchip_List, collect the inventory</span>
</span><span class="hll">      <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">switchip_list</span><span class="p">:</span>
</span><span class="hll">          <span class="c1"># For each switch IP, create empty directory with key as switch IP</span>
</span><span class="hll">          <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1"># Return the inventory to View</span>
</span><span class="hll">      <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>
</span>
  <span class="c1"># Initially form will be returned to the view.</span>
  <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the default.py and verify your script using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/add_inventory. Before that let us update the view (add_inventory.html) to display the title as &#8220;Add Switches&#8221;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="n">extend</span> <span class="s1">&#39;layout.html&#39;</span><span class="p">}}</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Add</span> <span class="n">Switches</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_vars</span><span class="p">)}}</span>
</pre></div>
</div>
<img alt="_images/ch08-pic8.png" src="_images/ch08-pic8.png" />
<p>When you enter <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/add_inventory, add_inventory() function executes. First, the form variable is assigned with the fields defined using SQLFORM.factory() method. When it executes &#8220;if form.process().accepted:&#8221;&#8221; statement, it bypasses the if clause since the form has not been submitted yet. Then the last statement of the add_inventory() function returns the form variable to the view add_inventory.html.</p>
<p>Once you enter the username, password, switch IPs and submit, &#8220;if form.process().accepted:&#8221; clause is executed. Since we define the variable inventory and return this dictionary to the view within the &#8220;if form.process().accepted:&#8221; clause, we are seeing the content of the dictionary &#8220;inventory&#8221; on the web page. The values of the form fields are assigned internally by form.vars.&lt;variable_name_defined_in_the_field&gt; (for example form.vars.username, form.vars.password and form.vars.switchip).</p>
<p>Now we understand how to use web2py forms and display data using view, let us update the add_inventory() function to collect the inventory of the switches and store it in the dictionary.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">import</span> <span class="nn">pyeapi</span>
</span>
<span class="c1"># Default Index for Home page of this tool</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># Prepare the Tool: Add Switches</span>
<span class="k">def</span> <span class="nf">add_inventory</span><span class="p">():</span>
    <span class="c1"># Display form to input Username, Password and Switch IP addresses</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;switchip&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Switch IPs&quot;</span><span class="p">))</span>

    <span class="c1"># if the form is accepted, collect the information from the switches</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="c1"># Initiate inventory &amp; error with blank dictionary</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="p">{}</span>
<span class="hll">        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
</span>
        <span class="c1"># Convert Switch IPs field from string to list</span>
        <span class="n">switchip_list</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">switchip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># For each IP in the List switchip_List, apply your logic</span>
        <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">switchip_list</span><span class="p">:</span>
            <span class="c1"># For each switch IP, create empty directory with key as switch IP</span>
            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Connect to Switches and Collect Inventory</span>
<span class="hll">            <span class="k">try</span><span class="p">:</span>
</span><span class="hll">                <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">username</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">                <span class="c1"># Collect the inventory</span>
</span><span class="hll">                <span class="n">show_hostname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
</span><span class="hll">                <span class="n">hostname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_hostname</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
</span><span class="hll">
</span><span class="hll">                <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
</span><span class="hll">                <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</span><span class="hll">
</span><span class="hll">                <span class="n">show_version</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show version&quot;</span><span class="p">])</span>
</span><span class="hll">                <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_version</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">])</span>
</span><span class="hll">                <span class="n">serialnumber</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_version</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;serialNumber&quot;</span><span class="p">])</span>
</span><span class="hll">
</span><span class="hll">                <span class="c1"># Save the collected data in the inventory dictionary</span>
</span><span class="hll">                <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="n">hostname</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;serialnumber&quot;</span><span class="p">:</span> <span class="n">serialnumber</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}</span>
</span><span class="hll">
</span><span class="hll">            <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
</span><span class="hll">                <span class="n">errors</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>
</span><span class="hll">
</span><span class="hll">            <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
</span><span class="hll">                <span class="n">errors</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>
</span>
        <span class="c1"># Return the inventory to View</span>
<span class="hll">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>
</span>
    <span class="c1"># Return form to view.</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the config and verify the result.</p>
<img alt="_images/ch08-pic9.png" src="_images/ch08-pic9.png" />
</div>
<div class="section" id="step-4-store-the-dictionary-into-a-json-file">
<h4><a class="toc-backref" href="#id8">Step 4: Store the dictionary into a JSON file</a><a class="headerlink" href="#step-4-store-the-dictionary-into-a-json-file" title="Permalink to this headline">¶</a></h4>
<p>Store the dictionary in JSON format and save under the folder /home/www-data/web2py/applications/Arista_EOS_Tool/databases/. The reason for storing the data in a file is that we will reuse this data (Switch IP addresses, site and role) by all the uses cases created in this tool.</p>
<p>First create a blank inventory.json file in the server.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>anees@ubuntu-web2py:~$ <span class="nb">cd</span> /home/www-data/web2py/applications/Arista_EOS_Tool/databases/

anees@ubuntu-web2py:/home/www-data/web2py/applications/Arista_EOS_Tool/databases$ sudo sh -c <span class="s2">&quot;echo {} &gt; inventory.json&quot;</span>

anees@ubuntu-web2py:/home/www-data/web2py/applications/Arista_EOS_Tool/databases$ sudo chown -R www-data:www-data inventory.json
</pre></div>
</div>
<p>Update the script to store the content of the dictionary (inventory) into this file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="hll"><span class="kn">import</span> <span class="nn">json</span>
</span>
<span class="hll"><span class="c1"># Define inventory file</span>
</span><span class="hll"><span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;/home/www-data/web2py/applications/Arista_EOS_Tool/databases/&quot;</span>
</span><span class="hll"><span class="n">file_inventory</span> <span class="o">=</span> <span class="s2">&quot;inventory.json&quot;</span>
</span><span class="hll"><span class="nb">file</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">file_inventory</span>
</span>
<span class="c1"># Default Index for Home page of this tool</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># Prepare the Tool: Add Switches</span>
<span class="k">def</span> <span class="nf">add_inventory</span><span class="p">():</span>
    <span class="c1"># Display form to input Username, Password and Switch IP addresses</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;switchip&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Switch IPs&quot;</span><span class="p">))</span>

    <span class="c1"># if the form is accepted, collect the information from the switches</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="c1"># Initiate inventory &amp; error with blank dictionary</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Convert Switch IPs field from string to list</span>
        <span class="n">switchip_list</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">switchip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># For each IP in the List switchip_List, apply your logic</span>
        <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">switchip_list</span><span class="p">:</span>
            <span class="c1"># For each switch IP, create empty directory with key as switch IP</span>
            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Connect to Switches and Collect Inventory</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">username</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

                <span class="c1"># Collect the inventory</span>
                <span class="n">show_hostname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
                <span class="n">hostname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_hostname</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>

                <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
                <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

                <span class="n">show_version</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show version&quot;</span><span class="p">])</span>
                <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_version</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">])</span>
                <span class="n">serialnumber</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_version</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;serialNumber&quot;</span><span class="p">])</span>

                <span class="c1"># Save the collected data in the inventory dictionary</span>
                <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="n">hostname</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;serialnumber&quot;</span><span class="p">:</span> <span class="n">serialnumber</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}</span>

            <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
                <span class="n">errors</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

            <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
                <span class="n">errors</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>

<span class="hll">        <span class="c1"># Store the dictionary &quot;inventory&quot; in the json file</span>
</span><span class="hll">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
</span><span class="hll">            <span class="n">current_inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>
</span><span class="hll">            <span class="n">current_inventory</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>
</span>
<span class="hll">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writefile</span><span class="p">:</span>
</span><span class="hll">            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">current_inventory</span><span class="p">,</span> <span class="n">writefile</span><span class="p">)</span>
</span>
        <span class="c1"># Return the inventory to View</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>

    <span class="c1"># Return form to view.</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Verify your script using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/add_inventory. The result will be displayed on the web page as before. You can also check the content of the inventory.json from the ubuntu server.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>anees@ubuntu-web2py:~$ <span class="nb">cd</span> /home/www-data/web2py/applications/Arista_EOS_Tool/databases/
anees@ubuntu-web2py:/home/www-data/web2py/applications/Arista_EOS_Tool/databases$ cat inventory.json
<span class="o">{</span><span class="s2">&quot;172.28.170.98&quot;</span>: <span class="o">{</span><span class="s2">&quot;serialnumber&quot;</span>: <span class="s2">&quot;JPE14080459&quot;</span>, <span class="s2">&quot;hostname&quot;</span>: <span class="s2">&quot;22sw4&quot;</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;4.15.3F&quot;</span>, <span class="s2">&quot;role&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;model&quot;</span>: <span class="s2">&quot;DCS-7050SX-128&quot;</span><span class="o">}</span>, <span class="s2">&quot;172.28.170.97&quot;</span>: <span class="o">{</span><span class="s2">&quot;serialnumber&quot;</span>: <span class="s2">&quot;JPE14080457&quot;</span>, <span class="s2">&quot;hostname&quot;</span>: <span class="s2">&quot;22sw2&quot;</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;4.15.3F&quot;</span>, <span class="s2">&quot;role&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;model&quot;</span>: <span class="s2">&quot;DCS-7050SX-128&quot;</span><span class="o">}</span>, <span class="s2">&quot;172.28.170.114&quot;</span>: <span class="o">{</span><span class="s2">&quot;serialnumber&quot;</span>: <span class="s2">&quot;JPE14421537&quot;</span>, <span class="s2">&quot;hostname&quot;</span>: <span class="s2">&quot;22sw35&quot;</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;4.15.3F&quot;</span>, <span class="s2">&quot;role&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;model&quot;</span>: <span class="s2">&quot;DCS-7250QX-64&quot;</span><span class="o">}</span>, <span class="s2">&quot;172.28.170.115&quot;</span>: <span class="o">{</span><span class="s2">&quot;serialnumber&quot;</span>: <span class="s2">&quot;JPE14402468&quot;</span>, <span class="s2">&quot;hostname&quot;</span>: <span class="s2">&quot;22sw37&quot;</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;4.15.3F&quot;</span>, <span class="s2">&quot;role&quot;</span>: <span class="s2">&quot;none&quot;</span>, <span class="s2">&quot;model&quot;</span>: <span class="s2">&quot;DCS-7250QX-64&quot;</span><span class="o">}}</span>anees@ubuntu-web2py:/home/www-data/web2py/applications/Arista_EOS_Tool/databases$
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="view-switches">
<h2><a class="toc-backref" href="#id9">View Switches</a><a class="headerlink" href="#view-switches" title="Permalink to this headline">¶</a></h2>
<p>&#8220;View Switches&#8221; task allows the users to view the inventory of the switches stored in the tool. We will write a new function called view_inventory() in the default.py to show the content of the inventory.json file. The logic is very simple. Read the json file into a dictionary and return that dictionary to the view.</p>
<p>Edit the default.py file of the web2py application Arista_EOS_Tool and add this view_inventory() function.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">view_inventory</span><span class="p">():</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
      <span class="n">inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a new web2py view view_inventory.html (default/view_inventory.html) for this new function using web2py editor.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="n">extend</span> <span class="s1">&#39;layout.html&#39;</span><span class="p">}}</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">View</span> <span class="n">Switches</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_vars</span><span class="p">)}}</span>
</pre></div>
</div>
<p>Verify the new function using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/view_inventory. You should see the result as below:</p>
<img alt="_images/ch08-pic10.png" src="_images/ch08-pic10.png" />
</div>
<div class="section" id="categorize-switches">
<h2><a class="toc-backref" href="#id10">Categorize Switches</a><a class="headerlink" href="#categorize-switches" title="Permalink to this headline">¶</a></h2>
<p>After we added the switches manually, we are going to classify the switches with based on the location and role. This gives the user an option to run any scripts in this tool against specific set of switches. For example, we will be writing a script to find unused ports. The user may want to run this script only on all leaf switches from a specific data center. Let us write an algorithm for this task.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id11">Algorithm</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>When a user adds switches using the add switches task, the script will save the inventory information in the inventory.json file. When it stores for the first time, it assigns the value &#8220;None&#8221; to the fields site and role.</p>
<p>In this categorize switches task, we are going to read and display the switches and its corresponding site and role in a web2py form. This will allow the users to assign site and role for all the switches in the inventory.json file.</p>
<ol class="arabic simple">
<li>Create a New Function and a View for this task &#8220;Categorize Switches&#8221;</li>
<li>Read the content of inventory.json file and assign it to a dictionary variable called inventory</li>
<li>Build a web2py form with the fields switch&#8217;s hostname, site and role from the content of inventory dictionary.</li>
<li>Once the user submit the form with the updated site and role fields, update the dictionary variable “inventory”</li>
<li>Write the dictionary inventory to the inventory.json file.</li>
</ol>
<div class="section" id="step-1-create-a-new-function-and-view-for-this-task-categorize-switches">
<h4><a class="toc-backref" href="#id12">Step 1: Create a New Function and View for this task &#8220;Categorize Switches&#8221;</a><a class="headerlink" href="#step-1-create-a-new-function-and-view-for-this-task-categorize-switches" title="Permalink to this headline">¶</a></h4>
<p>Edit the default.py file of the web2py application Arista_EOS_Tool and add this categorize_inventory() function.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_inventory</span><span class="p">():</span>
  <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
<p>Create a new web2py view categorize_inventory.html (default/categorize_inventory.html) for this new function using web2py editor.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="n">extend</span> <span class="s1">&#39;layout.html&#39;</span><span class="p">}}</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Categorize</span> <span class="n">Switches</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_vars</span><span class="p">)}}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-read-the-content-of-inventory-json-and-store-it-in-a-dictionary">
<h4><a class="toc-backref" href="#id13">Step 2: Read the content of inventory.json and store it in a dictionary</a><a class="headerlink" href="#step-2-read-the-content-of-inventory-json-and-store-it-in-a-dictionary" title="Permalink to this headline">¶</a></h4>
<p>Update the categorize_inventory() function to read the inventory.json file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_inventory</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-build-a-web2py-form-from-the-dictionary">
<h4><a class="toc-backref" href="#id14">Step 3: Build a web2py form from the dictionary</a><a class="headerlink" href="#step-3-build-a-web2py-form-from-the-dictionary" title="Permalink to this headline">¶</a></h4>
<p>This is an interesting step in this task. We have to build a form with the fields hostname, site and role from the content of inventory variable. First, how did we create a form previously in this chapter?</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;switchip&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Switch IPs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>In the above form, we know what fields need to be created. But in this use case, We have to create fields based on the content of inventory.json file. Our goal is to display field for each switch in the inventory.json file. Well actually we have to create two fields (Site and Role) for each switch in the inventory.json file.  So the number of fields depends on the number of switches in the inventory.json file.</p>
<p>Web2py form allows to create a form using a list of fields. You can create a list with the Field() objects and then you can create SQLFORM.factory using that list.</p>
<ul>
<li><p class="first">We are going to create two fields site and role for each switch.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;site”, label=str(hostname)+&quot;</span> <span class="n">Site</span><span class="s2">&quot;, default=site)</span>
<span class="n">Field</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Role&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>
</pre></div>
</div>
<p>&#8220;Site&#8221; and &#8220;Role&#8221; are the variable names for the data that the user is going to input. We use switch hostname as a label so that the user can classify the switch properly. We don’t want to show blank field for Site and Role. We want to populate the current Site and Role.</p>
</li>
<li><p class="first">We have to populate the above two fields for all the switches in the inventory file. So we need somehow to create unique variable names for “Site” and &#8220;Role.&#8221; We can use integers starting 1. For example, site1, role1 for switch1, site2, role2 for switch2, etc. We will put all these fields in a list.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Define an empty list for fields</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Define a variable for integers which we will use to create unique variable names</span>
<span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># For each switch, create fields and add it to the list field</span>
<span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
   <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>

   <span class="c1"># We will grab hostname, site and role from current inventory</span>
   <span class="c1"># We will use these in the Field variable</span>
   <span class="n">hostname</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span>
   <span class="n">site</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span>
   <span class="n">role</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span>

   <span class="c1"># create variables and append to the list</span>
   <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Site&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">site</span><span class="p">))</span>
   <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Role&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">role</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a form using the fields list</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Let us update the categorize_inventory() function with this new SQLFORM.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_inventory</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>

    <span class="c1"># Define an empty list for fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Define a variable for integers which we will use to create unique variable names</span>
    <span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># For each switch, create fields and add it to the list field</span>
    <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
       <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>

       <span class="c1"># We will grab hostname, site and role from current inventory</span>
       <span class="c1"># We will use these in the Field variable</span>
       <span class="n">hostname</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span>
       <span class="n">site</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span>
       <span class="n">role</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span>

       <span class="c1"># create variables and append to the list</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Site&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">site</span><span class="p">))</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Role&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">role</span><span class="p">))</span>

    <span class="c1"># Create a form using the list fields</span>
    <span class="n">form</span><span class="o">=</span><span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Test the script using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/categorize_inventory</p>
<img alt="_images/ch08-pic11.png" src="_images/ch08-pic11.png" />
</div>
<div class="section" id="step-4-update-site-and-role-field-in-the-dictionary">
<h4><a class="toc-backref" href="#id15">Step 4: Update site and role field in the dictionary</a><a class="headerlink" href="#step-4-update-site-and-role-field-in-the-dictionary" title="Permalink to this headline">¶</a></h4>
<p>As we have unique variable names for Site and Role for each switch in inventory.json file, we will use the similar &#8220;for loop&#8221; statement to update the dictionary &#8220;inventory.&#8221;</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_inventory</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>

    <span class="c1"># Define an empty list for fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Define a variable for integers which we will use to create unique variable names</span>
    <span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># For each switch, create fields and add it to the list field</span>
    <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
       <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>

       <span class="c1"># We will grab hostname, site and role from current inventory</span>
       <span class="c1"># We will use these in the Field variable</span>
       <span class="n">hostname</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span>
       <span class="n">site</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span>
       <span class="n">role</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span>

       <span class="c1"># create variables and append to the list</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Site&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">site</span><span class="p">))</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Role&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">role</span><span class="p">))</span>

    <span class="c1"># Create a form using the list fields</span>
    <span class="n">form</span><span class="o">=</span><span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>

<span class="hll">    <span class="c1"># Update dictionary based on the user input</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
</span><span class="hll">        <span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span class="hll">            <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class="hll">            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">)]</span>
</span><span class="hll">            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">)]</span>
</span><span class="hll">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>
</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Test the script using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/categorize_inventory</p>
<img alt="_images/ch08-pic12.png" src="_images/ch08-pic12.png" />
</div>
<div class="section" id="step-5-write-the-dictionary-in-the-inventory-json-file">
<h4><a class="toc-backref" href="#id16">Step 5: Write the dictionary in the inventory.json file</a><a class="headerlink" href="#step-5-write-the-dictionary-in-the-inventory-json-file" title="Permalink to this headline">¶</a></h4>
<p>We will update the script to write the dictionary into the inventory.json file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">categorize_inventory</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">readfile</span><span class="p">)</span>

    <span class="c1"># Define an empty list for fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Define a variable for integers which we will use to create unique variable names</span>
    <span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># For each switch, create fields and add it to the list field</span>
    <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
       <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>

       <span class="c1"># We will grab hostname, site and role from current inventory</span>
       <span class="c1"># We will use these in the Field variable</span>
       <span class="n">hostname</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span>
       <span class="n">site</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span>
       <span class="n">role</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span>

       <span class="c1"># create variables and append to the list</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Site&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">site</span><span class="p">))</span>
       <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Role&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">role</span><span class="p">))</span>

    <span class="c1"># Create a form using the list fields</span>
    <span class="n">form</span><span class="o">=</span><span class="n">SQLFORM</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>

    <span class="c1"># Update dictionary based on the user input</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="n">field_variable</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">each_switch_ip</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">field_variable</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">)]</span>
            <span class="n">inventory</span><span class="p">[</span><span class="n">each_switch_ip</span><span class="p">][</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field_variable</span><span class="p">)]</span>

<span class="hll">        <span class="c1"># Store the dictionary &quot;inventory&quot; in the json file</span>
</span><span class="hll">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writefile</span><span class="p">:</span>
</span><span class="hll">            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">writefile</span><span class="p">)</span>
</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Test the script using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/categorize_inventory</p>
<p>You can use the view_inventory() function to verify whether the data is updated in the inventory.json. Test view_inventory() using <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/view_inventory.</p>
<img alt="_images/ch08-pic13.png" src="_images/ch08-pic13.png" />
</div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id17">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We have completed three use cases under “Preparing the Tools” section. You can add more use cases as per your requirement. For example, you can create a use case for update inventory. If any of the inventory data such as hostname, software version or serial number (RMA), is changed, and if you need to delete any of the switches from the inventory, you can accomplish those with this use case.</p>
<p>Each use case is a separate function within the default controller &#8220;default.py&#8221; and we access each of these use cases with the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/&lt;Name-of-the-function&gt;.</p>
<p>Later in this book, we will create a home page with the links to all of these functions (use cases). The home page will be accessible using the URL <a class="reference external" href="https:/">https:/</a>/&lt;web-server&gt;/Arista_EOS_Tool/default/index.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="create-application.html" class="btn btn-neutral" title="Chapter 7: Creating a New Web2Py Application" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Anees Mohammed.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>