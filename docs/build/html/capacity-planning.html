

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 4: Capacity Planning Use Cases &mdash; Python for Network Engineers</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python for Network Engineers" href="index.html"/>
        <link rel="next" title="Chapter 5: Web2Py Introduction" href="web2py-introduction.html"/>
        <link rel="prev" title="Chapter 3: Troubleshooting Use Cases" href="troubleshooting.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> arista-python-web2py
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Chapter 1: Introducing Python Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="core-concepts.html">Chapter 2: Script Framework for Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Chapter 3: Troubleshooting Use Cases</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 4: Capacity Planning Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#port-capacity">Port Capacity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arista-eos-show-commands">Arista EOS Show Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#develop-script">Develop Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-script">Final Script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-scalability-assessment">Hardware Scalability Assessment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mac-address-table-scale">Mac Address Table Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#arista-eos-show-command">Arista EOS Show Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Develop Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vrf-scale">VRF Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Arista EOS Show Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Develop Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#arp-scale">ARP Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Arista EOS Show Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Develop Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#routing-scale">Routing Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Arista EOS Show Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Develop Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcam-scale">TCAM Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Arista EOS Show Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Develop Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-scale">Hardware Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exception-handling">Exception Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Final Script:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web2py-introduction.html">Chapter 5: Web2Py Introduction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">arista-python-web2py</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Chapter 4: Capacity Planning Use Cases</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/capacity-planning.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-4-capacity-planning-use-cases">
<h1>Chapter 4: Capacity Planning Use Cases<a class="headerlink" href="#chapter-4-capacity-planning-use-cases" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#port-capacity" id="id11">Port Capacity</a><ul>
<li><a class="reference internal" href="#arista-eos-show-commands" id="id12">Arista EOS Show Commands</a></li>
<li><a class="reference internal" href="#algorithm" id="id13">Algorithm</a></li>
<li><a class="reference internal" href="#develop-script" id="id14">Develop Script</a></li>
<li><a class="reference internal" href="#final-script" id="id15">Final Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hardware-scalability-assessment" id="id16">Hardware Scalability Assessment</a><ul>
<li><a class="reference internal" href="#mac-address-table-scale" id="id17">Mac Address Table Scale</a><ul>
<li><a class="reference internal" href="#arista-eos-show-command" id="id18">Arista EOS Show Command</a></li>
<li><a class="reference internal" href="#id1" id="id19">Develop Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vrf-scale" id="id20">VRF Scale</a><ul>
<li><a class="reference internal" href="#id2" id="id21">Arista EOS Show Command</a></li>
<li><a class="reference internal" href="#id3" id="id22">Develop Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arp-scale" id="id23">ARP Scale</a><ul>
<li><a class="reference internal" href="#id4" id="id24">Arista EOS Show Command</a></li>
<li><a class="reference internal" href="#id5" id="id25">Develop Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#routing-scale" id="id26">Routing Scale</a><ul>
<li><a class="reference internal" href="#id6" id="id27">Arista EOS Show Command</a></li>
<li><a class="reference internal" href="#id7" id="id28">Develop Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tcam-scale" id="id29">TCAM Scale</a><ul>
<li><a class="reference internal" href="#id8" id="id30">Arista EOS Show Command</a></li>
<li><a class="reference internal" href="#id9" id="id31">Develop Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hardware-scale" id="id32">Hardware Scale</a><ul>
<li><a class="reference internal" href="#exception-handling" id="id33">Exception Handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id34">Final Script:</a></li>
</ul>
</li>
</ul>
</div>
<p>We are going to develop scripts for a couple of capacity planning use cases.  First use case is to identify the available port density and the unused transceivers in the network. Second use case is to identify the usage of hardware resources such as mac address, arp, route and tcam tables. We introduce Python’s jsonrpc and functions in this chapter. We also show you how to explore the Arista EOS commands and the json output via graphical user interface.</p>
<div class="section" id="port-capacity">
<h2><a class="toc-backref" href="#id11">Port Capacity</a><a class="headerlink" href="#port-capacity" title="Permalink to this headline">¶</a></h2>
<p>The goal of this script is to identify the number of unused ports and transceivers in the network. We are going to collect the information and report it in the following format.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">unused_ports</span> <span class="o">=</span>
<span class="o">{</span>

switch_host_name: <span class="o">{</span> switch_model: &lt;switch_Model&gt;,
                              description: &lt;switch description&gt;,
                              10G: <span class="o">{</span>
                                                interface_type: &lt;Number of unused ports&gt;,
                                                interface_type: &lt;Number of unused ports&gt;
                                         <span class="o">}</span>,
                              40G: <span class="o">{</span>
                                                interface_type: &lt;Number of unused ports&gt;,
                                                interface_type: &lt;Number of unused ports&gt;
                                         <span class="o">}</span>
                  <span class="o">}</span>,
switch_host_name: <span class="o">{</span> switch_model: &lt;switch_Model&gt;,
                              description: &lt;switch description&gt;,
                              10G: <span class="o">{</span>
                                                interface_type: &lt;Number of unused ports&gt;,
                                                interface_type: &lt;Number of unused ports&gt;
                                         <span class="o">}</span>,
                              40G: <span class="o">{</span>
                                                interface_type: &lt;Number of unused ports&gt;,
                                                interface_type: &lt;Number of unused ports&gt;
                                         <span class="o">}</span>
                  <span class="o">}</span>,
<span class="o">}</span>
</pre></div>
</div>
<p>Under each switch, we will report how many 10GE, 40GE or 100GE ports are available. There are different transceiver types available and we will identify the different types and save the information.</p>
<p>First we will write down the step by step commands to collect the data, second we will develop an algorithm and finally we will build the Python script using our framework.</p>
<div class="section" id="arista-eos-show-commands">
<h3><a class="toc-backref" href="#id12">Arista EOS Show Commands</a><a class="headerlink" href="#arista-eos-show-commands" title="Permalink to this headline">¶</a></h3>
<p><strong>Step 1:</strong> Inventory</p>
<p>Model name and description provides additional insight when presenting unused ports. Show inventory command can be used to collect the model and switch description.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch#show inventory <span class="p">|</span> json

    <span class="s2">&quot;systemInformation&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;DCS-7050SX-128&quot;</span>,
        <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&quot;</span>,
        <span class="s2">&quot;mfgDate&quot;</span>: <span class="s2">&quot;2015-12-21&quot;</span>,
        <span class="s2">&quot;hardwareRev&quot;</span>: <span class="s2">&quot;02.00&quot;</span>,
        <span class="s2">&quot;serialNum&quot;</span>: <span class="s2">&quot;JPE14080459&quot;</span>
    <span class="o">}</span>,
</pre></div>
</div>
<p><strong>Step 2:</strong> Commands to collect the unused interfaces</p>
<p>“notconnect” option in &#8220;show interfaces status&#8221; shows the ports configured as “no shutdown” but links are not up. “disabled” option shows the ports configured as “shutdown”.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch# show interfaces status notconnect disabled <span class="p">|</span> json
<span class="o">{</span>
    <span class="s2">&quot;interfaceStatuses&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;Ethernet8&quot;</span>: <span class="o">{</span>
            <span class="s2">&quot;vlanInformation&quot;</span>: <span class="o">{</span>
                <span class="s2">&quot;interfaceMode&quot;</span>: <span class="s2">&quot;bridged&quot;</span>,
                <span class="s2">&quot;vlanId&quot;</span>: 1,
                <span class="s2">&quot;interfaceForwardingModel&quot;</span>: <span class="s2">&quot;bridged&quot;</span>
            <span class="o">}</span>,
<span class="hll">            <span class="s2">&quot;bandwidth&quot;</span>: 10000000000,
</span><span class="hll">            <span class="s2">&quot;interfaceType&quot;</span>: <span class="s2">&quot;10GBASE-SR&quot;</span>,
</span>            <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;&quot;</span>,
            <span class="s2">&quot;autoNegotiateActive&quot;</span>: false,
            <span class="s2">&quot;duplex&quot;</span>: <span class="s2">&quot;duplexFull&quot;</span>,
            <span class="s2">&quot;autoNegotigateActive&quot;</span>: false,
            <span class="s2">&quot;linkStatus&quot;</span>: <span class="s2">&quot;notconnect&quot;</span>,
            <span class="s2">&quot;lineProtocolStatus&quot;</span>: <span class="s2">&quot;notPresent&quot;</span>
        <span class="o">}</span>,
        <span class="s2">&quot;Ethernet9&quot;</span>: <span class="o">{</span>
            <span class="s2">&quot;vlanInformation&quot;</span>: <span class="o">{</span>
                <span class="s2">&quot;interfaceMode&quot;</span>: <span class="s2">&quot;bridged&quot;</span>,
                <span class="s2">&quot;vlanId&quot;</span>: 1,
                <span class="s2">&quot;interfaceForwardingModel&quot;</span>: <span class="s2">&quot;bridged&quot;</span>
            <span class="o">}</span>,
<span class="hll">            <span class="s2">&quot;bandwidth&quot;</span>: 10000000000,
</span><span class="hll">            <span class="s2">&quot;interfaceType&quot;</span>: <span class="s2">&quot;Not Present&quot;</span>,
</span>            <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;&quot;</span>,
            <span class="s2">&quot;autoNegotiateActive&quot;</span>: false,
            <span class="s2">&quot;duplex&quot;</span>: <span class="s2">&quot;duplexFull&quot;</span>,
            <span class="s2">&quot;autoNegotigateActive&quot;</span>: false,
            <span class="s2">&quot;linkStatus&quot;</span>: <span class="s2">&quot;notconnect&quot;</span>,
            <span class="s2">&quot;lineProtocolStatus&quot;</span>: <span class="s2">&quot;notPresent&quot;</span>
        <span class="o">}</span>,
</pre></div>
</div>
</div>
<div class="section" id="algorithm">
<h3><a class="toc-backref" href="#id13">Algorithm</a><a class="headerlink" href="#algorithm" title="Permalink to this headline">¶</a></h3>
<p>We are going to use the following algorithm to write the Python script.</p>
<ol class="arabic simple">
<li>Create an empty dictionary for unused_ports.
<strong>unused_ports = {}</strong></li>
<li>For each switch, create a {key: value} pair using the switch name as the key.
<strong>unused_ports[host_name] = {}</strong></li>
<li>For each switch, collect model and description, and update unused_ports dictionary.
<strong>unused_ports[host_name] = {“Model”: &lt;model&gt;, “Description”: &lt;description&gt; }</strong></li>
<li>For each switch, we will collect “show interfaces status notconnect disabled” output and parse through bandwidth and interface type values of each interface.</li>
<li>We will take the bandwidth value of each interface and check if there is an entry in the dictionary under the specific switch name. If there is no entry for that particular bandwidth, we will add a {key: value} pair entry for that bandwidth with the bandwidth as the key and an empty dictionary as the value.
<strong>unused_ports[host_name][bandwidth] = {}</strong></li>
<li>Next, we will look at the interface type of that interface. If there is no entry for that interface type within unused_ports[host_name][bandwidth], we will create one with a {key: value} pair. Key is the interface type and the value is an integer number “1”.
<strong>unused_ports[host_name][bandwidth][interfacetype] = 1</strong></li>
<li>If there is an entry for that interface type, we will increment the value by 1.
<strong>unused_ports[host_name][bandwidth][interfacetype] += 1</strong></li>
</ol>
</div>
<div class="section" id="develop-script">
<h3><a class="toc-backref" href="#id14">Develop Script</a><a class="headerlink" href="#develop-script" title="Permalink to this headline">¶</a></h3>
<p><strong>Prepare:</strong> Create a new Python script using the framework we developed.</p>
<p>Open the IDLE and create a new script and save as unused_ports.py in your folder. Copy the code from section 1, 2, 3 from our framework and paste it in this new script.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Discover Unused Ports in the network</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### Section 1</span>

<span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="c1">### Section 2</span>

<span class="c1"># Define file path and file names</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/&quot;</span>
<span class="n">file_name_switches</span> <span class="o">=</span> <span class="s2">&quot;switches.txt&quot;</span>
<span class="n">file_switches</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">file_name_switches</span>

<span class="c1"># Read the content of the file and save it in a List</span>

<span class="n">switches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_switches</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">switches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1">### Section 3</span>

<span class="c1"># Input Username and Password</span>

<span class="n">my_username</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your username: &quot;</span><span class="p">)</span>
<span class="n">my_password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your password: &quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Steps 1, 2 and 3:</strong>
Since we are already familiar with pyeapi, dictionary and for loop, we can start section 4 with the usual for loop, empty dictionary and pyeapi commands which are required for the first three steps of our algorithm.</p>
<p>Step 1: Create an empty dictionary for unused_ports.</p>
<p>Step 2: For each switch, create a {key: value} pair using the switch name as the key.</p>
<p>Step 3: For each switch, collect model and description, and update unused_ports dictionary.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>


    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
<p>Dictionary structure for model and description from show inventory has been derived from command API explorer. So far we have used Python shell to explore the syntax. Another method is to use command API explorer. After you enable management api on the Arista switch, you can access the switch via your browser with the URL <a class="reference external" href="https:/">https:/</a>/&lt;IP-address&gt;. It will prompt you for user name and password. After that you can type any EOS show command and click “submit POST request” to view the output in json format.</p>
<img alt="_images/ch04-pic1.png" src="_images/ch04-pic1.png" />
<p>Save and run the script from IDLE (Run → Run Module).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>, <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>, <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw4&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}}</span>
</pre></div>
</div>
<p><strong>Step 4:</strong> For each switch, we will collect “show interfaces status notconnect disabled” and parse through bandwidth and interface type values of each interface.</p>
<p>Before writing the script, we will identify the dictionary structure for bandwidth and interface type using command api explorer.</p>
<img alt="_images/ch04-pic2.png" src="_images/ch04-pic2.png" />
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

<span class="hll">        <span class="c1"># Collect interfaces status</span>
</span><span class="hll">        <span class="n">sh_int_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show interfaces status notconnect disabled&quot;</span><span class="p">])</span>
</span><span class="hll">        <span class="n">sh_int_status_clean</span> <span class="o">=</span> <span class="n">sh_int_status</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;interfaceStatuses&quot;</span><span class="p">]</span>
</span>
<span class="hll">        <span class="c1"># Identify unused ports and categorize based on bandwidth and transceiver type</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">each_interface</span> <span class="ow">in</span> <span class="n">sh_int_status_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span class="hll">            <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
</span><span class="hll">            <span class="n">bandwidth_GE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;GE&quot;</span>
</span><span class="hll">            <span class="n">interface_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;interfaceType&quot;</span><span class="p">])</span>
</span>
    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>, <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>, <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw4&#39;</span>: <span class="o">{</span><span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}}</span>
&gt;&gt;&gt; bandwidth
10000000000
&gt;&gt;&gt; bandwidth_GE
<span class="s1">&#39;10GE&#39;</span>
&gt;&gt;&gt; interface_type
<span class="s1">&#39;Not Present&#39;</span>
</pre></div>
</div>
<p><strong>Step 5:</strong> We will take the bandwidth value of each interface and check if there is an entry in the dictionary under the specific switch name.</p>
<p>If there is no entry for that particular bandwidth, we will add a {key: value} pair entry for that bandwidth with the bandwidth as the key and an empty dictionary as the value.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

        <span class="c1"># Collect interfaces status</span>
        <span class="n">sh_int_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show interfaces status notconnect disabled&quot;</span><span class="p">])</span>
        <span class="n">sh_int_status_clean</span> <span class="o">=</span> <span class="n">sh_int_status</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;interfaceStatuses&quot;</span><span class="p">]</span>

        <span class="c1"># Identify unused ports and categorize based on bandwidth and transceiver type</span>
        <span class="k">for</span> <span class="n">each_interface</span> <span class="ow">in</span> <span class="n">sh_int_status_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
            <span class="n">bandwidth_GE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;GE&quot;</span>
            <span class="n">interface_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;interfaceType&quot;</span><span class="p">])</span>

<span class="hll">            <span class="c1"># check for bandwidth entry and add it if not there</span>
</span><span class="hll">            <span class="k">if</span> <span class="n">bandwidth_GE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]:</span>
</span><span class="hll">                <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span>
    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;10GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;40GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{}</span>,
            <span class="s1">&#39;10GE&#39;</span>: <span class="o">{}</span>,
            <span class="s1">&#39;40GE&#39;</span>: <span class="o">{}</span>,
            <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>,
            <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{}</span>,
            <span class="s1">&#39;10GE&#39;</span>: <span class="o">{}</span>,
            <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>,
            <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw4&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;10GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;40GE&#39;</span>: <span class="o">{}</span>,
           <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}}</span>
</pre></div>
</div>
<p>The reason we are seeing 0 GE is because of the management interface. At the end of the script, we will add a couple of checks to skip management and dot1q sub interfaces.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="s2">&quot;Management2&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;vlanInformation&quot;</span>: <span class="o">{</span>
          <span class="s2">&quot;interfaceMode&quot;</span>: <span class="s2">&quot;routed&quot;</span>,
          <span class="s2">&quot;interfaceForwardingModel&quot;</span>: <span class="s2">&quot;routed&quot;</span>
      <span class="o">}</span>,
      <span class="s2">&quot;bandwidth&quot;</span>: 0,
      <span class="s2">&quot;interfaceType&quot;</span>: <span class="s2">&quot;10/100/1000&quot;</span>,
      <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;autoNegotiateActive&quot;</span>: true,
      <span class="s2">&quot;duplex&quot;</span>: <span class="s2">&quot;duplexUnknown&quot;</span>,
      <span class="s2">&quot;autoNegotigateActive&quot;</span>: true,
      <span class="s2">&quot;linkStatus&quot;</span>: <span class="s2">&quot;notconnect&quot;</span>,
      <span class="s2">&quot;lineProtocolStatus&quot;</span>: <span class="s2">&quot;down&quot;</span>
  <span class="o">}</span>,
</pre></div>
</div>
<p><strong>Step 6 and 7:</strong> Next, we will look at the interface type of that interface. If there is no entry for that interface type within unused_ports[host_name][bandwidth], we will create one with a {key: value} pair. Key is the interface type and the value is an integer number “1”. If there is an entry for that interface type, we will increment the value by 1.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

        <span class="c1"># Collect interfaces status</span>
        <span class="n">sh_int_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show interfaces status notconnect disabled&quot;</span><span class="p">])</span>
        <span class="n">sh_int_status_clean</span> <span class="o">=</span> <span class="n">sh_int_status</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;interfaceStatuses&quot;</span><span class="p">]</span>

        <span class="c1"># Identify unused ports and categorize based on bandwidth and transceiver type</span>
        <span class="k">for</span> <span class="n">each_interface</span> <span class="ow">in</span> <span class="n">sh_int_status_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
            <span class="n">bandwidth_GE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;GE&quot;</span>
            <span class="n">interface_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;interfaceType&quot;</span><span class="p">])</span>

            <span class="c1"># check for bandwidth entry and add it if not there</span>
            <span class="k">if</span> <span class="n">bandwidth_GE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]:</span>
                <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="hll">            <span class="c1"># check for interface type and add it if not there</span>
</span><span class="hll">            <span class="k">if</span> <span class="n">interface_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]:</span>
</span><span class="hll">                <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class="hll">            <span class="k">else</span><span class="p">:</span>
</span><span class="hll">                <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span>
    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10/100/1000&#39;</span>: 1, <span class="s1">&#39;N/A&#39;</span>: 1<span class="o">}</span>,
           <span class="s1">&#39;10GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10GBASE-CR&#39;</span>: 1,
                    <span class="s1">&#39;10GBASE-SR&#39;</span>: 1,
                    <span class="s1">&#39;Not Present&#39;</span>: 90,
                    <span class="s1">&#39;dot1q-encapsulation&#39;</span>: 3<span class="o">}</span>,
           <span class="s1">&#39;40GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;Not Present&#39;</span>: 5<span class="o">}</span>,
           <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10/100/1000&#39;</span>: 1<span class="o">}</span>,
            <span class="s1">&#39;10GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;Not Present&#39;</span>: 216<span class="o">}</span>,
            <span class="s1">&#39;40GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;Not Present&#39;</span>: 1<span class="o">}</span>,
            <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>,
            <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10/100/1000&#39;</span>: 1, <span class="s1">&#39;N/A&#39;</span>: 1<span class="o">}</span>,
            <span class="s1">&#39;10GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;40GBASE-CR4&#39;</span>: 3, <span class="s1">&#39;Not Present&#39;</span>: 220<span class="o">}</span>,
            <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;64x QSFP+ 2RU&#39;</span>,
            <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7250QX-64&#39;</span><span class="o">}</span>,
 <span class="s1">&#39;22sw4&#39;</span>: <span class="o">{</span><span class="s1">&#39;0GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10/100/1000&#39;</span>: 1<span class="o">}</span>,
           <span class="s1">&#39;10GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;10GBASE-CR&#39;</span>: 1,
                    <span class="s1">&#39;10GBASE-SR&#39;</span>: 1,
                    <span class="s1">&#39;Not Present&#39;</span>: 90,
                    <span class="s1">&#39;dot1q-encapsulation&#39;</span>: 3<span class="o">}</span>,
           <span class="s1">&#39;40GE&#39;</span>: <span class="o">{</span><span class="s1">&#39;Not Present&#39;</span>: 5<span class="o">}</span>,
           <span class="s1">&#39;Description&#39;</span>: <span class="s1">&#39;96x 10Gb SFP+ + 8x 40Gb QSFP+ 2RU&#39;</span>,
           <span class="s1">&#39;Model&#39;</span>: <span class="s1">&#39;DCS-7050SX-128&#39;</span><span class="o">}}</span>
</pre></div>
</div>
<p><strong>Step 8:</strong> Exclude non physical and management interfaces in the unused ports list.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

        <span class="c1"># Collect interfaces status</span>
        <span class="n">sh_int_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show interfaces status notconnect disabled&quot;</span><span class="p">])</span>
        <span class="n">sh_int_status_clean</span> <span class="o">=</span> <span class="n">sh_int_status</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;interfaceStatuses&quot;</span><span class="p">]</span>

        <span class="c1"># Identify unused ports and categorize based on bandwidth and transceiver type</span>
        <span class="k">for</span> <span class="n">each_interface</span> <span class="ow">in</span> <span class="n">sh_int_status_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="hll">            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">each_interface</span> <span class="ow">and</span> <span class="s2">&quot;Ethernet&quot;</span> <span class="ow">in</span> <span class="n">each_interface</span><span class="p">:</span>
</span>                <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
                <span class="n">bandwidth_GE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;GE&quot;</span>
                <span class="n">interface_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;interfaceType&quot;</span><span class="p">])</span>

                <span class="c1"># check for bandwidth entry and add it if not there</span>
                <span class="k">if</span> <span class="n">bandwidth_GE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># check for interface type and add it if not there</span>
                <span class="k">if</span> <span class="n">interface_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="final-script">
<h3><a class="toc-backref" href="#id15">Final Script</a><a class="headerlink" href="#final-script" title="Permalink to this headline">¶</a></h3>
<p>Here is the final script that shows the inventory of unused ports and transceivers in the network.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Discover Unused Ports in the network</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### Section 1</span>

<span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="c1">### Section 2</span>

<span class="c1"># Define file path and file names</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/&quot;</span>
<span class="n">file_name_switches</span> <span class="o">=</span> <span class="s2">&quot;switches.txt&quot;</span>
<span class="n">file_switches</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">file_name_switches</span>

<span class="c1"># Read the content of the file and save it in a List</span>

<span class="n">switches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_switches</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">switches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1">### Section 3</span>

<span class="c1"># Input Username and Password</span>

<span class="n">my_username</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your username: &quot;</span><span class="p">)</span>
<span class="n">my_password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your password: &quot;</span><span class="p">)</span>

<span class="c1">### Section 4</span>

<span class="c1"># Create an Empty Dictionary</span>
<span class="n">unused_ports</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define API Connection String</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">switch</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">my_username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">my_password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># collect the hostname of the switch and create an entry in the dictionary</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
        <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Collect the model name and device description</span>
        <span class="n">show_inventory</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show inventory&quot;</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">show_inventory</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;systemInformation&quot;</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>

        <span class="c1"># Collect interfaces status</span>
        <span class="n">sh_int_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show interfaces status notconnect disabled&quot;</span><span class="p">])</span>
        <span class="n">sh_int_status_clean</span> <span class="o">=</span> <span class="n">sh_int_status</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;interfaceStatuses&quot;</span><span class="p">]</span>

        <span class="c1"># Identify unused ports and categorize based on bandwidth and transceiver type</span>
        <span class="k">for</span> <span class="n">each_interface</span> <span class="ow">in</span> <span class="n">sh_int_status_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">each_interface</span> <span class="ow">and</span> <span class="s2">&quot;Ethernet&quot;</span> <span class="ow">in</span> <span class="n">each_interface</span><span class="p">:</span>
                <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
                <span class="n">bandwidth_GE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;GE&quot;</span>
                <span class="n">interface_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sh_int_status_clean</span><span class="p">[</span><span class="n">each_interface</span><span class="p">][</span><span class="s2">&quot;interfaceType&quot;</span><span class="p">])</span>

                <span class="c1"># check for bandwidth entry and add it if not there</span>
                <span class="k">if</span> <span class="n">bandwidth_GE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">]:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># check for interface type and add it if not there</span>
                <span class="k">if</span> <span class="n">interface_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">]:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unused_ports</span><span class="p">[</span><span class="n">host_name_clean</span><span class="p">][</span><span class="n">bandwidth_GE</span><span class="p">][</span><span class="n">interface_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ConnectionError: unable to connect to eAPI&quot;</span>

    <span class="k">except</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">eapilib</span><span class="o">.</span><span class="n">CommandError</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CommandError: Check your EOS command syntax&quot;</span>


<span class="c1">### Section 5</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">):</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unused_ports</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hardware-scalability-assessment">
<h2><a class="toc-backref" href="#id16">Hardware Scalability Assessment</a><a class="headerlink" href="#hardware-scalability-assessment" title="Permalink to this headline">¶</a></h2>
<p>The goal of this script is to identify the usage of hardware resources such as mac address, arp, route and tcam tables. We are going to collect the information and report it in the following format.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">Verify_scale</span> <span class="o">=</span>
<span class="o">{</span>

switch_host_name: <span class="o">{</span> “MAC Scale”: &lt;mac count&gt;,
                        “No. of VRFs”: &lt;no. of VRFs&gt;,
                        “ARP Scale”: &lt;arp count&gt;,
          “Routing Scale”: &lt;routes&gt;,
                        “TCAM Scale”: &lt;tcam entries&gt;,
                                 <span class="o">}</span>,
switch_host_name: <span class="o">{</span> “MAC Scale”: &lt;mac count&gt;,
                        “No. of VRFs”: &lt;no. of VRFs&gt;,
                        “ARP Scale”: &lt;arp count&gt;,
          “Routing Scale”: &lt;routes&gt;,
                        “TCAM Scale”: &lt;tcam entries&gt;,
                                 <span class="o">}</span>,
<span class="o">}</span>
</pre></div>
</div>
<p>We are going to develop the scripts individually for each of these hardware resources using Python functions and then we will combine these functions in one script.</p>
<div class="section" id="mac-address-table-scale">
<h3><a class="toc-backref" href="#id17">Mac Address Table Scale</a><a class="headerlink" href="#mac-address-table-scale" title="Permalink to this headline">¶</a></h3>
<div class="section" id="arista-eos-show-command">
<h4><a class="toc-backref" href="#id18">Arista EOS Show Command</a><a class="headerlink" href="#arista-eos-show-command" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch#show mac address-table count <span class="p">|</span> json
<span class="o">{</span>
    <span class="s2">&quot;vlanCounts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;115&quot;</span>: <span class="o">{</span>
<span class="hll">            <span class="s2">&quot;dynamic&quot;</span>: 2,
</span>            <span class="s2">&quot;unicast&quot;</span>: 1,
            <span class="s2">&quot;multicast&quot;</span>: 0
        <span class="o">}</span>,
        <span class="s2">&quot;116&quot;</span>: <span class="o">{</span>
<span class="hll">            <span class="s2">&quot;dynamic&quot;</span>: 0,
</span>            <span class="s2">&quot;unicast&quot;</span>: 0,
            <span class="s2">&quot;multicast&quot;</span>: 0
        <span class="o">}</span>,
        <span class="s2">&quot;4094&quot;</span>: <span class="o">{</span>
<span class="hll">            <span class="s2">&quot;dynamic&quot;</span>: 0,
</span>            <span class="s2">&quot;unicast&quot;</span>: 1,
            <span class="s2">&quot;multicast&quot;</span>: 0
        <span class="o">}</span>,
        <span class="s2">&quot;1&quot;</span>: <span class="o">{</span>
<span class="hll">            <span class="s2">&quot;dynamic&quot;</span>: 5,
</span>            <span class="s2">&quot;unicast&quot;</span>: 0,
            <span class="s2">&quot;multicast&quot;</span>: 0
        <span class="o">}</span>,
        <span class="s2">&quot;114&quot;</span>: <span class="o">{</span>
<span class="hll">            <span class="s2">&quot;dynamic&quot;</span>: 2,
</span>            <span class="s2">&quot;unicast&quot;</span>: 1,
            <span class="s2">&quot;multicast&quot;</span>: 0
        <span class="o">}</span>,
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id19">Develop Script</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>If you have observed all the scripts we have developed so far, we instantiate pyeapi object using connection parameters (IP address and authentication credentials) and using that object we execute various Arista EOS commands. In this script, we will instantiate the pyeapi object in the main script. Then we will create a function and define all the logic related to identifying mac address scale inside that function. First we will write this function to simply collect the mac address table count from the switch and print.</p>
<p>Open the IDLE, create a new script and save as mac_scale.py in your folder.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;172.28.170.97&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
<span class="o">{</span>u<span class="s1">&#39;id&#39;</span>: u<span class="s1">&#39;4439995728&#39;</span>,
 u<span class="s1">&#39;jsonrpc&#39;</span>: u<span class="s1">&#39;2.0&#39;</span>,
 u<span class="s1">&#39;result&#39;</span>: <span class="o">[{</span>u<span class="s1">&#39;vlanCounts&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;1&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;dynamic&#39;</span>: 5,
                                     u<span class="s1">&#39;multicast&#39;</span>: 0,
                                     u<span class="s1">&#39;unicast&#39;</span>: 0<span class="o">}</span>,
                              u<span class="s1">&#39;201&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;dynamic&#39;</span>: 0,
                                       u<span class="s1">&#39;multicast&#39;</span>: 0,
                                       u<span class="s1">&#39;unicast&#39;</span>: 1<span class="o">}</span>,
                              u<span class="s1">&#39;202&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;dynamic&#39;</span>: 0,
                                       u<span class="s1">&#39;multicast&#39;</span>: 0,
                                       u<span class="s1">&#39;unicast&#39;</span>: 1<span class="o">}</span>,
                              u<span class="s1">&#39;203&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;dynamic&#39;</span>: 0,
                                       u<span class="s1">&#39;multicast&#39;</span>: 0,
                                       u<span class="s1">&#39;unicast&#39;</span>: 1<span class="o">}</span>,
</pre></div>
</div>
<p>We can also pass the result back to the main script and we can print from the main script.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
<span class="hll">    <span class="k">return</span> <span class="n">mac</span>
</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;172.28.170.97&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="hll"><span class="n">mac</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span class="hll"><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>
</span></pre></div>
</div>
<p>We can write the script to add the values of mac[&#8220;result&#8221;][0][&#8220;vlanCounts&#8221;][vlan][ &#8220;dynamic&#8221;]  from each vlan. Let’s add this logic in the function and return the total mac count instead of the per vlan mac count.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyeapi</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
<span class="hll">    <span class="n">show_mac_clean</span> <span class="o">=</span> <span class="n">show_mac</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;vlanCounts&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">mac_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll">    <span class="k">for</span> <span class="n">each_vlan</span> <span class="ow">in</span> <span class="n">show_mac_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span class="hll">        <span class="n">mac_count</span> <span class="o">+=</span> <span class="n">show_mac_clean</span><span class="p">[</span><span class="n">each_vlan</span><span class="p">][</span><span class="s2">&quot;dynamic&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">mac_count</span>
</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;172.28.170.98&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">mac_count</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">mac_count</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vrf-scale">
<h3><a class="toc-backref" href="#id20">VRF Scale</a><a class="headerlink" href="#vrf-scale" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id21">Arista EOS Show Command</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch#show vrf <span class="p">|</span> json
<span class="hll">% This is an unconverted <span class="nb">command</span>
</span>
22sw4#show vrf
   Vrf        RD            Protocols       State             Interfaces
---------- ------------- --------------- -------------------- ---------------
   <span class="m">101</span>        101:101       ipv4,ipv6       v4:routing,       Ethernet97.101,
                                            v6:no routing     Ethernet98.101,
                                                              Vlan101
   <span class="m">102</span>        102:102       ipv4,ipv6       v4:routing,       Ethernet97.102,
                                            v6:no routing     Ethernet98.102,
                                                              Vlan102
   <span class="m">103</span>        103:103       ipv4,ipv6       v4:routing,       Ethernet97.103,
                                            v6:no routing     Ethernet98.103,
                                                              Vlan103
   <span class="m">104</span>        104:104       ipv4,ipv6       v4:routing,       Ethernet97.104,
                                            v6:no routing     Ethernet98.104,
                                                              Vlan104
   <span class="m">105</span>        105:105       ipv4,ipv6       v4:routing,       Ethernet97.105,
                                            v6:no routing     Ethernet98.105,
                                                              Vlan105
   <span class="m">106</span>        106:106       ipv4,ipv6       v4:routing,       Ethernet97.106,
                                            v6:no routing     Ethernet98.106,
                                                              Vlan106
</pre></div>
</div>
<p>As you can see, “show vrf” command is not converted to json format. We will explore how we can parse the required data for the commands that are not converted to json format.</p>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id22">Develop Script</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Open the IDLE, create a new script and save as vrf_scale.py in your folder.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyeapi</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">pyeapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;172.28.170.98&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;show vrf&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/test.py&quot;</span>, line 5, in &lt;module&gt;
    <span class="nv">show_vrf</span> <span class="o">=</span> node.execute<span class="o">([</span><span class="s2">&quot;show vrf&quot;</span><span class="o">])</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/pyeapi/eapilib.py&quot;</span>, line 464, in execute
    <span class="nv">response</span> <span class="o">=</span> self.send<span class="o">(</span>request<span class="o">)</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/pyeapi/eapilib.py&quot;</span>, line 385, in send
    raise CommandError<span class="o">(</span>code, msg, <span class="nv">command_error</span><span class="o">=</span>err, <span class="nv">output</span><span class="o">=</span>out<span class="o">)</span>
<span class="hll">CommandError: CLI <span class="nb">command</span> <span class="m">1</span> of <span class="m">1</span> <span class="s1">&#39;show vrf&#39;</span> failed: unconverted <span class="nb">command</span>
</span></pre></div>
</div>
<p>Since the command is not converted to json format, we have to collect the output using “text” format. For that we are going to use the Python module called jsonrpclib instead of Arista’s pyeapi module.</p>
<p>Install the jsonrpclib module using pip on your system.</p>
<div class="literal-block-wrapper container" id="apple-mac">
<div class="code-block-caption"><span class="caption-text">Apple Mac</span><a class="headerlink" href="#apple-mac" title="Permalink to this code">¶</a></div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>anees:~ anees$ pip install jsonrpclib
</pre></div>
</div>
</div>
<p>We will write a script using jsonrpc to collect the output for “show vrf” in “text” format.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/test.py&quot;</span>, line 5, in &lt;module&gt;
    <span class="nv">show_vrf</span> <span class="o">=</span> node.runCmds<span class="o">(</span>1, <span class="o">[</span><span class="s2">&quot;show vrf&quot;</span><span class="o">]</span>, <span class="s2">&quot;text&quot;</span><span class="o">)</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/jsonrpclib/jsonrpc.py&quot;</span>, line 288, in __call__

!!! Output truncated

<span class="s2">&quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/ssl.py&quot;</span>, line 808, in do_handshake
    self._sslobj.do_handshake<span class="o">()</span>
<span class="hll">SSLError: <span class="o">[</span>SSL: CERTIFICATE_VERIFY_FAILED<span class="o">]</span> certificate verify failed <span class="o">(</span>_ssl.c:590<span class="o">)</span>
</span></pre></div>
</div>
<p>SSLError is due to the fact that certification verification is enabled by default from Python 2.7.9 onwards. For more information refer <a class="reference external" href="https://www.python.org/dev/peps/pep-0476/">PEP 476</a>. We will disable SSL verification to move forward with the script.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="hll"><span class="kn">import</span> <span class="nn">ssl</span>
</span><span class="hll"><span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>

<span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">================================</span> <span class="n">RESTART</span> <span class="o">================================</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_vrf</span>
<span class="go">[{u&#39;output&#39;: u&#39;   Vrf        RD            Protocols       State             Interfaces      \n</span>
<span class="go">                ---------- ------------- --------------- -------------------- --------------- \n</span>
<span class="go">                101        101:101       ipv4,ipv6       v4:routing,          Ethernet97.101, \n</span>
<span class="go">                                                            v6:no routing     Ethernet98.101, \n</span>
<span class="go">                                                                              Vlan101         \n</span>
<span class="go">                102        102:102       ipv4,ipv6       v4:routing,       Ethernet97.102, \n</span>
<span class="go">                                                            v6:no routing     Ethernet98.102, \n</span>
<span class="go">                                                                              Vlan102         \n</span>
<span class="go">                103        103:103       ipv4,ipv6       v4:routing,       Ethernet97.103, \n</span>
<span class="go">                                                           v6:no routing</span>
</pre></div>
</div>
<p>We have to use Python’s string parsing modules such as splitlines() and split() to parse line by line and word by word to get the required field. This method is often called as screen scrapping.</p>
<p>As you can see from the “show vrf” output, it has some of the lines of data that are not necessary for our specific use case. This may make the parsing complicated as well. So we use EOS’s include option to filter only the required line and then we use Python’s string parsing modules to collect the necessary field.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch#show vrf <span class="p">|</span> inc ipv4,ipv6
   <span class="m">101</span>        101:101       ipv4,ipv6       v4:routing,       Ethernet97.101,
   <span class="m">102</span>        102:102       ipv4,ipv6       v4:routing,       Ethernet97.102,
   <span class="m">103</span>        103:103       ipv4,ipv6       v4:routing,       Ethernet97.103,
   <span class="m">104</span>        104:104       ipv4,ipv6       v4:routing,       Ethernet97.104,
   <span class="m">105</span>        105:105       ipv4,ipv6       v4:routing,       Ethernet97.105,
   <span class="m">106</span>        106:106       ipv4,ipv6       v4:routing,       Ethernet97.106,
</pre></div>
</div>
<p>Let us update the vrf_scale.py with the EOS command with the filters.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Save and run the script. Then we are going to explore Python&#8217;s string parsing functions to derive the list of VRFs.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">================================</span> <span class="n">RESTART</span> <span class="o">================================</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_vrf</span>
<span class="go">[{u&#39;output&#39;: u&#39;   101        101:101       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.101, \n   102        102:102       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.102, \n   103        103:103       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.103, \n   104        104:104       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.104, \n   105        105:105       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.105, \n   106        106:106       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.106, \n   107        107:107       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.107, \n   108        108:108       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.108, \n   109        109:109       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.109, \n   110        110:110       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.110, \n   111        111:111       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.111, \n   112        112:112       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.112, \n   113        113:113       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.113, \n   114        114:114       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.114, \n   115        115:115       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.115, \n   mgmt       100:100       ipv4,ipv6       v4:no routing,</span>
<span class="go">Management1     \n&#39;}]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
<span class="go">u&#39;   101        101:101       ipv4,ipv6       v4:routing,       Ethernet97.101,</span>
<span class="go">\n   102        102:102       ipv4,ipv6       v4:routing,       Ethernet97.102,</span>
<span class="go">\n   103        103:103       ipv4,ipv6       v4:routing,       Ethernet97.103,</span>
<span class="go">\n   104        104:104       ipv4,ipv6       v4:routing,       Ethernet97.104,</span>
<span class="go">\n   105        105:105       ipv4,ipv6       v4:routing,       Ethernet97.105,</span>
<span class="go">\n   106        106:106       ipv4,ipv6       v4:routing,       Ethernet97.106,</span>
<span class="go">\n   107        107:107       ipv4,ipv6       v4:routing,       Ethernet97.107,</span>
<span class="go">\n   108        108:108       ipv4,ipv6       v4:routing,       Ethernet97.108,</span>
<span class="go">\n   109        109:109       ipv4,ipv6       v4:routing,       Ethernet97.109,</span>
<span class="go">\n   110        110:110       ipv4,ipv6       v4:routing,       Ethernet97.110,</span>
<span class="go">\n   111        111:111       ipv4,ipv6       v4:routing,       Ethernet97.111,</span>
<span class="go">\n   112        112:112       ipv4,ipv6       v4:routing,       Ethernet97.112,</span>
<span class="go">\n   113        113:113       ipv4,ipv6       v4:routing,       Ethernet97.113,</span>
<span class="go">\n   114        114:114       ipv4,ipv6       v4:routing,       Ethernet97.114,</span>
<span class="go">\n   115        115:115       ipv4,ipv6       v4:routing,       Ethernet97.115,</span>
<span class="go">\n   mgmt       100:100       ipv4,ipv6       v4:no routing,    Management1</span>
<span class="go">\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="go">[u&#39;   101        101:101       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.101, &#39;, u&#39;   102        102:102       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.102, &#39;, u&#39;   103        103:103       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.103, &#39;, u&#39;   104        104:104       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.104, &#39;, u&#39;   105        105:105       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.105, &#39;, u&#39;   106        106:106       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.106, &#39;, u&#39;   107        107:107       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.107, &#39;, u&#39;   108        108:108       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.108, &#39;, u&#39;   109        109:109       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.109, &#39;, u&#39;   110        110:110       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.110, &#39;, u&#39;   111        111:111       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.111, &#39;, u&#39;   112        112:112       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.112, &#39;, u&#39;   113        113:113       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.113, &#39;, u&#39;   114        114:114       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.114, &#39;, u&#39;   115        115:115       ipv4,ipv6       v4:routing,</span>
<span class="go">Ethernet97.115, &#39;, u&#39;   mgmt       100:100       ipv4,ipv6       v4:no routing,</span>
<span class="go">Management1     &#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
<span class="go">&lt;type &#39;list&#39;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
<span class="go">      print each_line</span>


<span class="go">   101        101:101       ipv4,ipv6       v4:routing,       Ethernet97.101,</span>
<span class="go">   102        102:102       ipv4,ipv6       v4:routing,       Ethernet97.102,</span>
<span class="go">   103        103:103       ipv4,ipv6       v4:routing,       Ethernet97.103,</span>
<span class="go">   104        104:104       ipv4,ipv6       v4:routing,       Ethernet97.104,</span>
<span class="go">   105        105:105       ipv4,ipv6       v4:routing,       Ethernet97.105,</span>
<span class="go">   106        106:106       ipv4,ipv6       v4:routing,       Ethernet97.106,</span>
<span class="go">   107        107:107       ipv4,ipv6       v4:routing,       Ethernet97.107,</span>
<span class="go">   108        108:108       ipv4,ipv6       v4:routing,       Ethernet97.108,</span>
<span class="go">   109        109:109       ipv4,ipv6       v4:routing,       Ethernet97.109,</span>
<span class="go">   110        110:110       ipv4,ipv6       v4:routing,       Ethernet97.110,</span>
<span class="go">   111        111:111       ipv4,ipv6       v4:routing,       Ethernet97.111,</span>
<span class="go">   112        112:112       ipv4,ipv6       v4:routing,       Ethernet97.112,</span>
<span class="go">   113        113:113       ipv4,ipv6       v4:routing,       Ethernet97.113,</span>
<span class="go">   114        114:114       ipv4,ipv6       v4:routing,       Ethernet97.114,</span>
<span class="go">   115        115:115       ipv4,ipv6       v4:routing,       Ethernet97.115,</span>
<span class="go">   mgmt       100:100       ipv4,ipv6       v4:no routing,    Management1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">each_line</span>
<span class="go">u&#39;   mgmt       100:100       ipv4,ipv6       v4:no routing,    Management1     &#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="go">[u&#39;mgmt&#39;, u&#39;100:100&#39;, u&#39;ipv4,ipv6&#39;, u&#39;v4:no&#39;, u&#39;routing,&#39;, u&#39;Management1&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">u&#39;mgmt&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;mgmt&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
<span class="go">      print str(each_line.split()[0])</span>

<span class="go">101</span>
<span class="go">102</span>
<span class="go">103</span>
<span class="go">104</span>
<span class="go">105</span>
<span class="go">106</span>
<span class="go">107</span>
<span class="go">108</span>
<span class="go">109</span>
<span class="go">110</span>
<span class="go">111</span>
<span class="go">112</span>
<span class="go">113</span>
<span class="go">114</span>
<span class="go">115</span>
<span class="go">mgmt</span>
</pre></div>
</div>
<p>Now we have an idea on how to use jsonrpc to collect the show output in “text” format and parse the output using Python’s string processing modules.</p>
<p>Let’s update our script with a function for VRF scale.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>

    <span class="c1"># Create a list to store the VRFs</span>
<span class="hll">    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
</span>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="hll">        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span>    <span class="k">return</span> <span class="n">vrfs</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>
<span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="hll"><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Number of VRFs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vrfs</span><span class="p">)))</span>
</span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;VRFs List&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">vrfs</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Number of VRFs: 16
VRFs List
<span class="o">[</span>u<span class="s1">&#39;101&#39;</span>,
 u<span class="s1">&#39;102&#39;</span>,
 u<span class="s1">&#39;103&#39;</span>,
 u<span class="s1">&#39;104&#39;</span>,
 u<span class="s1">&#39;105&#39;</span>,
 u<span class="s1">&#39;106&#39;</span>,
 u<span class="s1">&#39;107&#39;</span>,
 u<span class="s1">&#39;108&#39;</span>,
 u<span class="s1">&#39;109&#39;</span>,
 u<span class="s1">&#39;110&#39;</span>,
 u<span class="s1">&#39;111&#39;</span>,
 u<span class="s1">&#39;112&#39;</span>,
 u<span class="s1">&#39;113&#39;</span>,
 u<span class="s1">&#39;114&#39;</span>,
 u<span class="s1">&#39;115&#39;</span>,
 u<span class="s1">&#39;mgmt&#39;</span><span class="o">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arp-scale">
<h3><a class="toc-backref" href="#id23">ARP Scale</a><a class="headerlink" href="#arp-scale" title="Permalink to this headline">¶</a></h3>
<p>In VRF environment, we have to calculate the number of ARP entries per VRF and add them to derive the total number of ARP entries.</p>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id24">Arista EOS Show Command</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span> Arista-switch# show ip arp vrf <span class="m">101</span> summary <span class="p">|</span> json
 <span class="o">{</span>
<span class="hll">     <span class="s2">&quot;dynamicEntries&quot;</span>: 3,
</span>     <span class="s2">&quot;ipV4Neighbors&quot;</span>: <span class="o">[]</span>,
     <span class="s2">&quot;notLearnedEntries&quot;</span>: 0,
     <span class="s2">&quot;totalEntries&quot;</span>: 3,
     <span class="s2">&quot;staticEntries&quot;</span>: 0
 <span class="o">}</span>

 Arista-switch# show ip arp vrf <span class="m">107</span> summary <span class="p">|</span> json
 <span class="o">{</span>
<span class="hll">     <span class="s2">&quot;dynamicEntries&quot;</span>: 4,
</span>     <span class="s2">&quot;ipV4Neighbors&quot;</span>: <span class="o">[]</span>,
     <span class="s2">&quot;notLearnedEntries&quot;</span>: 0,
     <span class="s2">&quot;totalEntries&quot;</span>: 4,
     <span class="s2">&quot;staticEntries&quot;</span>: 0
 <span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id25">Develop Script</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Since we already wrote a function called vrf_scale to identify the VRF names, we can use that function to get the list of VRFs and then we can write a program to identify the ARP scale using that list.</p>
<p>Create a new Python script from IDLE and save it as arp_scale.py.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="hll"><span class="k">def</span> <span class="nf">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
</span><span class="hll">    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
</span><span class="hll">        <span class="n">show_arp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip arp vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
</span><span class="hll">        <span class="k">print</span> <span class="n">show_arp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dynamicEntries&quot;</span><span class="p">]</span>
</span>
<span class="c1"># Define Connection Attributes</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>

<span class="c1"># Call VRF function and get the VRF names</span>
<span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="c1"># Call ARP function</span>
<span class="hll"><span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
3
</pre></div>
</div>
<p>Let us complete the script by adding these number of ARP entries per VRF and return only the total number of ARP entries from the function.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="k">def</span> <span class="nf">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
<span class="hll">    <span class="n">arp_count</span> <span class="o">=</span> <span class="mi">0</span>
</span>    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_arp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip arp vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
<span class="hll">        <span class="n">arp_count</span> <span class="o">+=</span> <span class="n">show_arp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dynamicEntries&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">arp_count</span>
</span>
<span class="c1"># Define Connection Attributes</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>

<span class="c1"># Call VRF function and get the VRF names</span>
<span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="c1"># Call ARP function</span>
<span class="hll"><span class="n">arp_count</span> <span class="o">=</span> <span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
</span>
<span class="hll"><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Total Number of ARP entries </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arp_count</span><span class="p">))</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Total Number of ARP entries 33
</pre></div>
</div>
</div>
</div>
<div class="section" id="routing-scale">
<h3><a class="toc-backref" href="#id26">Routing Scale</a><a class="headerlink" href="#routing-scale" title="Permalink to this headline">¶</a></h3>
<p>In VRF environment, we have to calculate number of routes per VRF and add them to derive the total number of routes.</p>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id27">Arista EOS Show Command</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch# show ip route vrf <span class="m">101</span> summary <span class="p">|</span> json
<span class="o">{</span>
    <span class="s2">&quot;maskLen&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;24&quot;</span>: 626,
        <span class="s2">&quot;8&quot;</span>: 2,
        <span class="s2">&quot;32&quot;</span>: 207609,
        <span class="s2">&quot;31&quot;</span>: 6
    <span class="o">}</span>,
<span class="hll">    <span class="s2">&quot;totalRoutes&quot;</span>: 208243,
</span>    <span class="s2">&quot;staticNexthopGroup&quot;</span>: 0,
    <span class="s2">&quot;bgpCounts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;bgpExternal&quot;</span>: 208229,
        <span class="s2">&quot;bgpInternal&quot;</span>: 0,
        <span class="s2">&quot;bgpTotal&quot;</span>: 208229
    <span class="o">}</span>,

Arista-switch# show ip route vrf <span class="m">102</span> summary <span class="p">|</span> json
<span class="o">{</span>
    <span class="s2">&quot;maskLen&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;24&quot;</span>: 626,
        <span class="s2">&quot;8&quot;</span>: 2,
        <span class="s2">&quot;32&quot;</span>: 9,
        <span class="s2">&quot;31&quot;</span>: 6
    <span class="o">}</span>,
<span class="hll">    <span class="s2">&quot;totalRoutes&quot;</span>: 643,
</span>    <span class="s2">&quot;staticNexthopGroup&quot;</span>: 0,
    <span class="s2">&quot;bgpCounts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;bgpExternal&quot;</span>: 629,
        <span class="s2">&quot;bgpInternal&quot;</span>: 0,
        <span class="s2">&quot;bgpTotal&quot;</span>: 629
    <span class="o">}</span>,
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id28">Develop Script</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>We are going to use the same logic as arp_scale.py script to calculate the route scale. We use vrf_scale function to get the list of VRFs and then by using that list we will write a function for calculating route scale.</p>
<p>Create a new Python script from IDLE and save it as route_scale.py.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="hll"><span class="k">def</span> <span class="nf">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
</span><span class="hll">    <span class="n">route_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll">    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
</span><span class="hll">        <span class="n">show_route</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip route vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
</span><span class="hll">        <span class="n">route_count</span> <span class="o">+=</span> <span class="n">show_route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;totalRoutes&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">route_count</span>
</span>
<span class="c1"># Define Connection Attributes</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>

<span class="c1"># Call VRF function and get the VRF names</span>
<span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="c1"># Call Route function</span>
<span class="hll"><span class="n">route_count</span> <span class="o">=</span> <span class="n">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
</span>
<span class="hll"><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Total Number of IPv4 routes </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">route_count</span><span class="p">))</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Total Number of IPv4 routes 234
</pre></div>
</div>
</div>
</div>
<div class="section" id="tcam-scale">
<h3><a class="toc-backref" href="#id29">TCAM Scale</a><a class="headerlink" href="#tcam-scale" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id30">Arista EOS Show Command</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch# show platform trident tcam <span class="p">|</span> json
<span class="hll">% This is an unconverted <span class="nb">command</span>
</span>
Arista-switch# show platform trident <span class="nv">tcam</span>
<span class="o">===</span> TCAM summary <span class="k">for</span> switch Linecard0/0 <span class="o">===</span>
<span class="hll">TCAM group <span class="m">20</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
</span>  MLAG uses <span class="m">1</span> entries.
<span class="hll">TCAM group <span class="m">10</span> uses <span class="m">38</span> entries and can use up to <span class="m">1754</span> more.
</span>  Mlag control traffic uses <span class="m">4</span> entries.
  CVX traffic uses <span class="m">6</span> entries.
  L3 Control Priority uses <span class="m">20</span> entries.
  IGMP Snooping Flooding uses <span class="m">8</span> entries.
<span class="hll">TCAM group <span class="m">11</span> uses <span class="m">58</span> entries and can use up to <span class="m">1734</span> more.
</span>  ACL Management uses <span class="m">10</span> entries.
  L2 Control Priority uses <span class="m">10</span> entries.
  Storm Control Management uses <span class="m">2</span> entries.
  ARP Inspection uses <span class="m">1</span> entries.
  L3 Routing uses <span class="m">35</span> entries.
<span class="hll">TCAM group <span class="m">43</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
</span>  Vxlan EFP uses <span class="m">1</span> entries.
</pre></div>
</div>
<p>We will collect the &#8220;show platform&#8221; output in &#8220;text&#8221; format and parse through the string to collect the number of TCAM entries. We can pipe the show output to receive only the interesting lines.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Arista-switch# show platform trident tcam <span class="p">|</span> include TCAM group
TCAM group <span class="m">20</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
TCAM group <span class="m">10</span> uses <span class="m">38</span> entries and can use up to <span class="m">1754</span> more.
TCAM group <span class="m">11</span> uses <span class="m">58</span> entries and can use up to <span class="m">1734</span> more.
TCAM group <span class="m">43</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id31">Develop Script</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Create a new Python script from IDLE and save it as tcam_scale.py.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>

<span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/test.py&quot;</span>, line 8, in &lt;module&gt;
    <span class="nv">show_tcam</span> <span class="o">=</span> node.runCmds<span class="o">(</span>1, <span class="o">[</span><span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="o">]</span>, <span class="s2">&quot;text&quot;</span><span class="o">)</span>
<span class="hll">ProtocolError: <span class="o">(</span>1002, u<span class="s2">&quot;CLI command 1 of 1 &#39;show platform trident tcam | include TCAM group&#39; failed: invalid command&quot;</span><span class="o">)</span>
</span></pre></div>
</div>
<p>We need to understand why this command fails when we are running using jsonrpc. Let’s open the command-api explorer for this switch and test the command.</p>
<img alt="_images/ch04-pic3.png" src="_images/ch04-pic3.png" />
<p>The above output shows that the command should run from privileged mode. So we need to send the command “enable” in front of “show platform trident tcam” command.</p>
<img alt="_images/ch04-pic4.png" src="_images/ch04-pic4.png" />
<p>Let’s update the tcam_scale.py script to run the “show platform trident tcam” from privileged mode. Then we will explore the options to strip out the interesting data.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
&gt;&gt;&gt; show_tcam
<span class="o">[{</span>u<span class="s1">&#39;output&#39;</span>: u<span class="s1">&#39;&#39;</span><span class="o">}</span>, <span class="o">{</span>u<span class="s1">&#39;output&#39;</span>: u<span class="s1">&#39;TCAM group 20 uses 1 entry and can use up to 767 more.\nTCAM group 10 uses 38 entries and can use up to 1754 more.\nTCAM group 11 uses 58 entries and can use up to 1734 more.\nTCAM group 43 uses 1 entry and can use up to 767 more.\n&#39;</span><span class="o">}]</span>
&gt;&gt;&gt;
&gt;&gt;&gt; show_tcam<span class="o">[</span>1<span class="o">]</span>
<span class="o">{</span>u<span class="s1">&#39;output&#39;</span>: u<span class="s1">&#39;TCAM group 20 uses 1 entry and can use up to 767 more.\nTCAM group 10 uses 38 entries and can use up to 1754 more.\nTCAM group 11 uses 58 entries and can use up to 1734 more.\nTCAM group 43 uses 1 entry and can use up to 767 more.\n&#39;</span><span class="o">}</span>
&gt;&gt;&gt;
&gt;&gt;&gt; show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>
u<span class="s1">&#39;TCAM group 20 uses 1 entry and can use up to 767 more.\nTCAM group 10 uses 38 entries and can use up to 1754 more.\nTCAM group 11 uses 58 entries and can use up to 1734 more.\nTCAM group 43 uses 1 entry and can use up to 767 more.\n&#39;</span>
&gt;&gt;&gt;
&gt;&gt;&gt; show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>.splitlines<span class="o">()</span>
<span class="o">[</span>u<span class="s1">&#39;TCAM group 20 uses 1 entry and can use up to 767 more.&#39;</span>, u<span class="s1">&#39;TCAM group 10 uses 38 entries and can use up to 1754 more.&#39;</span>, u<span class="s1">&#39;TCAM group 11 uses 58 entries and can use up to 1734 more.&#39;</span>, u<span class="s1">&#39;TCAM group 43 uses 1 entry and can use up to 767 more.&#39;</span><span class="o">]</span>
&gt;&gt;&gt;
&gt;&gt;&gt; <span class="k">for</span> each_line in show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>.splitlines<span class="o">()</span>:
           print each_line

TCAM group <span class="m">20</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
TCAM group <span class="m">10</span> uses <span class="m">38</span> entries and can use up to <span class="m">1754</span> more.
TCAM group <span class="m">11</span> uses <span class="m">58</span> entries and can use up to <span class="m">1734</span> more.
TCAM group <span class="m">43</span> uses <span class="m">1</span> entry and can use up to <span class="m">767</span> more.
&gt;&gt;&gt;
&gt;&gt;&gt; each_line
u<span class="s1">&#39;TCAM group 43 uses 1 entry and can use up to 767 more.&#39;</span>
&gt;&gt;&gt;
&gt;&gt;&gt; each_line.split<span class="o">()</span>
<span class="o">[</span>u<span class="s1">&#39;TCAM&#39;</span>, u<span class="s1">&#39;group&#39;</span>, u<span class="s1">&#39;43&#39;</span>, u<span class="s1">&#39;uses&#39;</span>, u<span class="s1">&#39;1&#39;</span>, u<span class="s1">&#39;entry&#39;</span>, u<span class="s1">&#39;and&#39;</span>, u<span class="s1">&#39;can&#39;</span>, u<span class="s1">&#39;use&#39;</span>, u<span class="s1">&#39;up&#39;</span>, u<span class="s1">&#39;to&#39;</span>, u<span class="s1">&#39;767&#39;</span>, u<span class="s1">&#39;more.&#39;</span><span class="o">]</span>
&gt;&gt;&gt;
&gt;&gt;&gt; each_line.split<span class="o">()[</span>4<span class="o">]</span>
u<span class="s1">&#39;1&#39;</span>
&gt;&gt;&gt; <span class="k">for</span> each_line in show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>.splitlines<span class="o">()</span>:
           print each_line.split<span class="o">()[</span>4<span class="o">]</span>

1
38
58
1
&gt;&gt;&gt; <span class="nv">tcam_count</span> <span class="o">=</span> 0
&gt;&gt;&gt;
&gt;&gt;&gt; <span class="k">for</span> each_line in show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>.splitlines<span class="o">()</span>:
           tcam_count +<span class="o">=</span> each_line.split<span class="o">()[</span>4<span class="o">]</span>

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;&lt;pyshell#49&gt;&quot;</span>, line 2, in &lt;module&gt;
    tcam_count +<span class="o">=</span> each_line.split<span class="o">()[</span>4<span class="o">]</span>
TypeError: unsupported operand type<span class="o">(</span>s<span class="o">)</span> <span class="k">for</span> +<span class="o">=</span>: <span class="s1">&#39;int&#39;</span> and <span class="s1">&#39;unicode&#39;</span>
&gt;&gt;&gt;
&gt;&gt;&gt; <span class="k">for</span> each_line in show_tcam<span class="o">[</span>1<span class="o">][</span><span class="s2">&quot;output&quot;</span><span class="o">]</span>.splitlines<span class="o">()</span>:
           tcam_count +<span class="o">=</span> int<span class="o">(</span>each_line.split<span class="o">()[</span>4<span class="o">])</span>

&gt;&gt;&gt; tcam_count
98
</pre></div>
</div>
<p>Let’s update the tcam_scale.py script with a Python function.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">tcam_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_tcam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">tcam_count</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tcam_count</span>

<span class="c1"># Define Connection Attributes</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>

<span class="c1"># Call tcam scale function</span>
<span class="n">tcam_count</span> <span class="o">=</span> <span class="n">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Total Number of TCAM Entries used is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tcam_count</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hardware-scale">
<h3><a class="toc-backref" href="#id32">Hardware Scale</a><a class="headerlink" href="#hardware-scale" title="Permalink to this headline">¶</a></h3>
<p>We will consolidate all the five scalability use cases in one script. Since we used jsonrpc for most of the scalability use cases, we will convert the mac scalability function to use jsonrpc instead of pyeapi. We will also add a function to find the hostname of the switch for storing the hardware scale under the switch name.</p>
<p>Create a new Python script from IDLE and save it as hardware_scale.py.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
    <span class="n">show_mac_clean</span> <span class="o">=</span> <span class="n">show_mac</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;vlanCounts&quot;</span><span class="p">]</span>
    <span class="n">mac_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vlan</span> <span class="ow">in</span> <span class="n">show_mac_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">mac_count</span> <span class="o">+=</span> <span class="n">show_mac_clean</span><span class="p">[</span><span class="n">each_vlan</span><span class="p">][</span><span class="s2">&quot;dynamic&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mac_count</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="k">def</span> <span class="nf">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">arp_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_arp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip arp vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">arp_count</span> <span class="o">+=</span> <span class="n">show_arp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dynamicEntries&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arp_count</span>

<span class="k">def</span> <span class="nf">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">route_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_route</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip route vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">route_count</span> <span class="o">+=</span> <span class="n">show_route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;totalRoutes&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">route_count</span>

<span class="k">def</span> <span class="nf">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">tcam_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_tcam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">tcam_count</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tcam_count</span>

<span class="k">def</span> <span class="nf">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
    <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">host_name_clean</span>


<span class="c1"># Define Connection Attributes for jsonrpc</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>

<span class="c1"># Call the hardware scale functions</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">mac_count</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">arp_count</span> <span class="o">=</span> <span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
<span class="n">route_count</span> <span class="o">=</span> <span class="n">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
<span class="n">tcam_count</span> <span class="o">=</span> <span class="n">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="c1"># Store the values in a dictionary</span>
<span class="n">verify_scale</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">verify_scale</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MAC Scale&quot;</span><span class="p">:</span> <span class="n">mac_count</span><span class="p">,</span>
                      <span class="s2">&quot;Number of VRFs&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vrfs</span><span class="p">),</span>
                      <span class="s2">&quot;Number of ARP Entries&quot;</span><span class="p">:</span> <span class="n">arp_count</span><span class="p">,</span>
                      <span class="s2">&quot;Number of Routes&quot;</span><span class="p">:</span> <span class="n">route_count</span><span class="p">,</span>
                      <span class="s2">&quot;Number of TCAM entries used&quot;</span><span class="p">:</span> <span class="n">tcam_count</span>
                      <span class="p">}</span>

<span class="c1"># Print the result</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">verify_scale</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and the run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 5,
           <span class="s1">&#39;Number of ARP Entries&#39;</span>: 33,
           <span class="s1">&#39;Number of Routes&#39;</span>: 234,
           <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 98,
           <span class="s1">&#39;Number of VRFs&#39;</span>: 16<span class="o">}}</span>
</pre></div>
</div>
<p>Now we have the logic for the script to find the hardware scale. Next we will integrate this script with our framework. We will start with section 1, 2 and 3 of the script framework.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script for hardware scalability assessment</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### Section 1</span>

<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="c1">### Section 2</span>

<span class="c1"># Define file path and file names</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/&quot;</span>
<span class="n">file_name_switches</span> <span class="o">=</span> <span class="s2">&quot;switches.txt&quot;</span>
<span class="n">file_switches</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">file_name_switches</span>

<span class="c1"># Read the content of the file and save it in a List</span>

<span class="n">switches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_switches</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">switches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1">### Section 3</span>

<span class="c1"># Input Username and Password</span>

<span class="n">my_username</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your username: &quot;</span><span class="p">)</span>
<span class="n">my_password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your password: &quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s add all the scalability assessment functions in section 4A.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">## Section 4A - Define Hardware Scalability Assessment Functions</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
    <span class="n">show_mac_clean</span> <span class="o">=</span> <span class="n">show_mac</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;vlanCounts&quot;</span><span class="p">]</span>
    <span class="n">mac_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vlan</span> <span class="ow">in</span> <span class="n">show_mac_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">mac_count</span> <span class="o">+=</span> <span class="n">show_mac_clean</span><span class="p">[</span><span class="n">each_vlan</span><span class="p">][</span><span class="s2">&quot;dynamic&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mac_count</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="k">def</span> <span class="nf">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">arp_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_arp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip arp vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">arp_count</span> <span class="o">+=</span> <span class="n">show_arp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dynamicEntries&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arp_count</span>

<span class="k">def</span> <span class="nf">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">route_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_route</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip route vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">route_count</span> <span class="o">+=</span> <span class="n">show_route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;totalRoutes&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">route_count</span>

<span class="k">def</span> <span class="nf">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">tcam_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_tcam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">tcam_count</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tcam_count</span>

<span class="k">def</span> <span class="nf">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
    <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">host_name_clean</span>
</pre></div>
</div>
<p>Our script for hardware scalability assessment is written for a single switch and we hard coded switch IP, username and password in the script. We need to redefine the jsonrpc connection object using variables.</p>
<p>We are going to rewrite this statement</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>with variables as below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">my_username</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">my_password</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">switch</span><span class="o">+</span><span class="s2">&quot;/command-api&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we need to run this main script for all the switches, we will create a for loop and place the main script that calls all the functions within the for loop.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 4B - Main Script</span>

<span class="n">verify_scale</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>

    <span class="c1"># Define Connection Attributes for jsonrpc</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">my_username</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">my_password</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">switch</span><span class="o">+</span><span class="s2">&quot;/command-api&quot;</span><span class="p">)</span>

    <span class="c1"># Call the hardware scale functions</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">mac_count</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">arp_count</span> <span class="o">=</span> <span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
    <span class="n">route_count</span> <span class="o">=</span> <span class="n">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
    <span class="n">tcam_count</span> <span class="o">=</span> <span class="n">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="c1"># Store the values in a dictionary</span>

    <span class="n">verify_scale</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MAC Scale&quot;</span><span class="p">:</span> <span class="n">mac_count</span><span class="p">,</span>
                          <span class="s2">&quot;Number of VRFs&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vrfs</span><span class="p">),</span>
                          <span class="s2">&quot;Number of ARP Entries&quot;</span><span class="p">:</span> <span class="n">arp_count</span><span class="p">,</span>
                          <span class="s2">&quot;Number of Routes&quot;</span><span class="p">:</span> <span class="n">route_count</span><span class="p">,</span>
                          <span class="s2">&quot;Number of TCAM entries used&quot;</span><span class="p">:</span> <span class="n">tcam_count</span>
                          <span class="p">}</span>
</pre></div>
</div>
<p>Finally we will print the result in the section 5 using pprint module.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 5</span>

<span class="c1"># Print the result</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">verify_scale</span><span class="p">)</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 5,
           <span class="s1">&#39;Number of ARP Entries&#39;</span>: 33,
           <span class="s1">&#39;Number of Routes&#39;</span>: 234,
           <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 98,
           <span class="s1">&#39;Number of VRFs&#39;</span>: 16<span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 0,
            <span class="s1">&#39;Number of ARP Entries&#39;</span>: 2050,
            <span class="s1">&#39;Number of Routes&#39;</span>: 6307,
            <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 510,
            <span class="s1">&#39;Number of VRFs&#39;</span>: 17<span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 0,
            <span class="s1">&#39;Number of ARP Entries&#39;</span>: 2046,
            <span class="s1">&#39;Number of Routes&#39;</span>: 6273,
            <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 510,
            <span class="s1">&#39;Number of VRFs&#39;</span>: 18<span class="o">}}</span>
</pre></div>
</div>
<div class="section" id="exception-handling">
<h4><a class="toc-backref" href="#id33">Exception Handling</a><a class="headerlink" href="#exception-handling" title="Permalink to this headline">¶</a></h4>
<p>One final feature we need to add in our script is exception handling. Without the exception handling, the script will terminate even if one switch is not accessible or any one EOS command is incorrect. Our goal is to save the error in a variable and continue executing the program for other switches or EOS commands. Also our goal is to differentiate if it is a connectivity (or access) issue or incorrect EOS command.</p>
<p>To understand the syntax of output error for inaccessible switch and incorrect EOS commands, we will test the script for those errors. We create a small script called jsonexception.py with incorrect EOS command “show hostname1”.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>
<span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname1&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/anees/jsonexception.py&quot;</span>, line 9, in &lt;module&gt;
    <span class="nv">host_name</span> <span class="o">=</span> node.runCmds<span class="o">(</span>1, <span class="o">[</span><span class="s2">&quot;show hostname1&quot;</span><span class="o">])</span>
<span class="hll">ProtocolError: <span class="o">(</span>1002, u<span class="s2">&quot;CLI command 1 of 1 &#39;show hostname1&#39; failed: invalid command&quot;</span><span class="o">)</span>
</span>
&gt;&gt;&gt; import jsonrpclib
&gt;&gt;&gt; dir<span class="o">(</span>jsonrpclib<span class="o">)</span>
<span class="o">[</span><span class="s1">&#39;Config&#39;</span>, <span class="s1">&#39;Fault&#39;</span>, <span class="s1">&#39;History&#39;</span>, <span class="s1">&#39;MultiCall&#39;</span>, <span class="s1">&#39;ProtocolError&#39;</span>, <span class="s1">&#39;Server&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__file__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>, <span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__path__&#39;</span>, <span class="s1">&#39;config&#39;</span>, <span class="s1">&#39;dumps&#39;</span>, <span class="s1">&#39;history&#39;</span>, <span class="s1">&#39;jsonclass&#39;</span>, <span class="s1">&#39;jsonrpc&#39;</span>, <span class="s1">&#39;loads&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Now we will update the script to handle this exception message &#8220;ProtocolError&#8221;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">ProtocolError</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="hll"><span class="k">try</span><span class="p">:</span>
</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.97/command-api&quot;</span><span class="p">)</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname1&quot;</span><span class="p">])</span>

<span class="hll"><span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class="hll">    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Invalid EOS Command </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Invalid EOS Command <span class="o">(</span>1002, u<span class="s2">&quot;CLI command 1 of 1 &#39;show hostname1&#39; failed: invalid command&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>In this example, 172.28.170.98 switch is accessible but username and password are not admin/admin.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">ProtocolError</span>

<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">try</span><span class="p">:</span>
<span class="hll">    <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>
</span>    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>

<span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Invalid EOS Command </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/Users/anees/jsonexception.py&quot;</span>, line 7, in &lt;module&gt;
    <span class="nv">host_name</span> <span class="o">=</span> node.runCmds<span class="o">(</span>1, <span class="o">[</span><span class="s2">&quot;show hostname&quot;</span><span class="o">])</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/jsonrpclib/jsonrpc.py&quot;</span>, line 288, in __call__
    <span class="k">return</span> self.__send<span class="o">(</span>self.__name, args<span class="o">)</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/jsonrpclib/jsonrpc.py&quot;</span>, line 237, in _request
    <span class="nv">response</span> <span class="o">=</span> self._run_request<span class="o">(</span>request<span class="o">)</span>
  File <span class="s2">&quot;/Library/Python/2.7/site-packages/jsonrpclib/jsonrpc.py&quot;</span>, line 255, in _run_request
    <span class="nv">verbose</span><span class="o">=</span>self.__verbose
  File <span class="s2">&quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/xmlrpclib.py&quot;</span>, line 1280, in request
    <span class="k">return</span> self.single_request<span class="o">(</span>host, handler, request_body, verbose<span class="o">)</span>
  File <span class="s2">&quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/xmlrpclib.py&quot;</span>, line 1328, in single_request
    response.msg,
ProtocolError: &lt;ProtocolError <span class="k">for</span> admin:admin@172.28.170.98/command-api: <span class="m">401</span> Unauthorized&gt;
</pre></div>
</div>
<p>As you can see, &#8220;except ProtocolError&#8221; does not catch this exception of incorrect authentication and the script fails. We will create a except clause to catch all the other error messages.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">ProtocolError</span>

<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://admin:admin@172.28.170.98/command-api&quot;</span><span class="p">)</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>

<span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Invalid EOS Command </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="hll"><span class="k">except</span><span class="p">:</span>
</span><span class="hll">    <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;eAPI Connection Error&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
eAPI Connection Error
</pre></div>
</div>
<p>Let’s update the section 1 &amp; 4B of the script with the exception handling method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">### Section 1</span>

<span class="kn">import</span> <span class="nn">pprint</span>
<span class="hll"><span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">ProtocolError</span>
</span><span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="c1">### Section 4B - Main Program</span>

<span class="n">verify_scale</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
<span class="hll">    <span class="k">try</span><span class="p">:</span>
</span>        <span class="c1"># Define Connection Attributes for jsonrpc</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">my_username</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">my_password</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">switch</span><span class="o">+</span><span class="s2">&quot;/command-api&quot;</span><span class="p">)</span>

        <span class="c1"># Call the hardware scale functions</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">mac_count</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">arp_count</span> <span class="o">=</span> <span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
        <span class="n">route_count</span> <span class="o">=</span> <span class="n">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
        <span class="n">tcam_count</span> <span class="o">=</span> <span class="n">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Store the values in a dictionary</span>

        <span class="n">verify_scale</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MAC Scale&quot;</span><span class="p">:</span> <span class="n">mac_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of VRFs&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vrfs</span><span class="p">),</span>
                              <span class="s2">&quot;Number of ARP Entries&quot;</span><span class="p">:</span> <span class="n">arp_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of Routes&quot;</span><span class="p">:</span> <span class="n">route_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of TCAM entries used&quot;</span><span class="p">:</span> <span class="n">tcam_count</span>
                              <span class="p">}</span>

<span class="hll">    <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class="hll">        <span class="n">verify_scale</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Invalid EOS Command&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span>
<span class="hll">    <span class="k">except</span><span class="p">:</span>
</span><span class="hll">        <span class="n">verify_scale</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;eAPI Connection Error&quot;</span>
</span></pre></div>
</div>
<p>Now let us test the script. On the switches.txt file, we are going to add an IP address  “172.28.170.98” which we know that having an authentication issue.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>172.28.170.97
172.28.170.98
172.28.170.115
172.28.170.114
</pre></div>
</div>
<p>Save and run the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; <span class="o">================================</span> <span class="nv">RESTART</span> <span class="o">================================</span>
&gt;&gt;&gt;
Enter your username: admin
<span class="o">{</span><span class="s1">&#39;172.28.170.98&#39;</span>: <span class="s1">&#39;eAPI Connection Error&#39;</span>,
 <span class="s1">&#39;22sw2&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 5,
           <span class="s1">&#39;Number of ARP Entries&#39;</span>: 33,
           <span class="s1">&#39;Number of Routes&#39;</span>: 234,
           <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 98,
           <span class="s1">&#39;Number of VRFs&#39;</span>: 16<span class="o">}</span>,
 <span class="s1">&#39;22sw35&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 0,
            <span class="s1">&#39;Number of ARP Entries&#39;</span>: 2050,
            <span class="s1">&#39;Number of Routes&#39;</span>: 6307,
            <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 510,
            <span class="s1">&#39;Number of VRFs&#39;</span>: 17<span class="o">}</span>,
 <span class="s1">&#39;22sw37&#39;</span>: <span class="o">{</span><span class="s1">&#39;MAC Scale&#39;</span>: 0,
            <span class="s1">&#39;Number of ARP Entries&#39;</span>: 2046,
            <span class="s1">&#39;Number of Routes&#39;</span>: 6273,
            <span class="s1">&#39;Number of TCAM entries used&#39;</span>: 510,
            <span class="s1">&#39;Number of VRFs&#39;</span>: 18<span class="o">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id34">Final Script:</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script for hardware scalability assessment</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### Section 1</span>

<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">jsonrpclib</span> <span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">ProtocolError</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="c1">### Section 2</span>

<span class="c1"># Define file path and file names</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;/Users/anees/Google Drive/my-scripts/&quot;</span>
<span class="n">file_name_switches</span> <span class="o">=</span> <span class="s2">&quot;switches.txt&quot;</span>
<span class="n">file_switches</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">file_name_switches</span>

<span class="c1"># Read the content of the file and save it in a List</span>

<span class="n">switches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_switches</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">readfile</span><span class="p">:</span>
        <span class="n">switches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1">### Section 3</span>

<span class="c1"># Input Username and Password</span>

<span class="n">my_username</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your username: &quot;</span><span class="p">)</span>
<span class="n">my_password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your password: &quot;</span><span class="p">)</span>

<span class="c1">### Section 4A - Define Hardware Scale Functions</span>

<span class="k">def</span> <span class="nf">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_mac</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show mac address-table count&quot;</span><span class="p">])</span>
    <span class="n">show_mac_clean</span> <span class="o">=</span> <span class="n">show_mac</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;vlanCounts&quot;</span><span class="p">]</span>
    <span class="n">mac_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vlan</span> <span class="ow">in</span> <span class="n">show_mac_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">mac_count</span> <span class="o">+=</span> <span class="n">show_mac_clean</span><span class="p">[</span><span class="n">each_vlan</span><span class="p">][</span><span class="s2">&quot;dynamic&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mac_count</span>

<span class="k">def</span> <span class="nf">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">show_vrf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show vrf | include ipv4,ipv6&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="n">show_vrf_clean</span> <span class="o">=</span> <span class="n">show_vrf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">vrfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">show_vrf_clean</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">vrfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vrfs</span>

<span class="k">def</span> <span class="nf">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">arp_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_arp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip arp vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">arp_count</span> <span class="o">+=</span> <span class="n">show_arp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dynamicEntries&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arp_count</span>

<span class="k">def</span> <span class="nf">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">):</span>
    <span class="n">route_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each_vrf</span> <span class="ow">in</span> <span class="n">vrfs</span><span class="p">:</span>
        <span class="n">show_route</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show ip route vrf &quot;</span> <span class="o">+</span> <span class="n">each_vrf</span> <span class="o">+</span> <span class="s2">&quot; summary&quot;</span><span class="p">])</span>
        <span class="n">route_count</span> <span class="o">+=</span> <span class="n">show_route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;totalRoutes&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">route_count</span>

<span class="k">def</span> <span class="nf">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">tcam_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">show_tcam</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;enable&quot;</span><span class="p">,</span> <span class="s2">&quot;show platform trident tcam | include TCAM group&quot;</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">each_line</span> <span class="ow">in</span> <span class="n">show_tcam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">tcam_count</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">each_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tcam_count</span>

<span class="k">def</span> <span class="nf">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">runCmds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show hostname&quot;</span><span class="p">])</span>
    <span class="n">host_name_clean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hostname&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">host_name_clean</span>

<span class="c1">### Section 4B - Main Program</span>

<span class="n">verify_scale</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="n">switches</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Define Connection Attributes for jsonrpc</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">my_username</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">my_password</span><span class="o">+</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">switch</span><span class="o">+</span><span class="s2">&quot;/command-api&quot;</span><span class="p">)</span>

        <span class="c1"># Call the hardware scale functions</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">hostname</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">mac_count</span> <span class="o">=</span> <span class="n">mac_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">vrfs</span> <span class="o">=</span> <span class="n">vrf_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">arp_count</span> <span class="o">=</span> <span class="n">arp_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
        <span class="n">route_count</span> <span class="o">=</span> <span class="n">route_scale</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">vrfs</span><span class="p">)</span>
        <span class="n">tcam_count</span> <span class="o">=</span> <span class="n">tcam_scale</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Store the values in a dictionary</span>

        <span class="n">verify_scale</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MAC Scale&quot;</span><span class="p">:</span> <span class="n">mac_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of VRFs&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vrfs</span><span class="p">),</span>
                              <span class="s2">&quot;Number of ARP Entries&quot;</span><span class="p">:</span> <span class="n">arp_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of Routes&quot;</span><span class="p">:</span> <span class="n">route_count</span><span class="p">,</span>
                              <span class="s2">&quot;Number of TCAM entries used&quot;</span><span class="p">:</span> <span class="n">tcam_count</span>
                              <span class="p">}</span>

    <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">verify_scale</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Invalid EOS Command&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">verify_scale</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;eAPI Connection Error&quot;</span>

<span class="c1">### Section 5</span>

<span class="c1"># Print the result</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">verify_scale</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="web2py-introduction.html" class="btn btn-neutral float-right" title="Chapter 5: Web2Py Introduction" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="troubleshooting.html" class="btn btn-neutral" title="Chapter 3: Troubleshooting Use Cases" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Anees Mohammed.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>